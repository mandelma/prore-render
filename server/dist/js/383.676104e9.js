"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[383,365],{7572:function(e,i,n){n.d(i,{Z:function(){return p}});var o=n(3396),s=n(7139);const t={key:0},l={class:"waiting-info"},r={key:1},a={class:"info"},d={key:0},c={key:1};function m(e,i,n,m,g,u){const h=(0,o.up)("monthConverter"),k=(0,o.up)("MDBBtnClose");return"for-recipient-test"===n.status?((0,o.wg)(),(0,o.iD)("div",t,[(0,o._)("div",l,[(0,o._)("b",null,(0,s.zw)(n.msg.provider),1),(0,o.Uk)(" - "+(0,s.zw)(n.msg.header)+" ",1),(0,o.Wm)(h,{num:n.msg.onTime[0].month},null,8,["num"]),(0,o.Uk)(", "+(0,s.zw)(n.msg.onTime[0].day)+", "+(0,s.zw)(n.msg.onTime[0].year)+" kello "+(0,s.zw)(n.msg.onTime[0].hours)+" : "+(0,s.zw)(n.msg.onTime[0].minutes),1)])])):((0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("div",a,[(0,o.Wm)(k,{class:"closeConfirmedBooking",onClick:u.handleCloseInfo},null,8,["onClick"]),"for-provider"===n.status?((0,o.wg)(),(0,o.iD)("div",d,[(0,o._)("h2",null,[(0,o._)("b",null,(0,s.zw)(n.msg.header),1)]),(0,o.Uk)(" "+(0,s.zw)(n.msg.address)+" ",1),(0,o.Wm)(h,{num:n.msg.onTime[0].month},null,8,["num"]),(0,o.Uk)(", "+(0,s.zw)(n.msg.onTime[0].day)+", "+(0,s.zw)(n.msg.onTime[0].year)+" kello "+(0,s.zw)(n.msg.onTime[0].hours)+" : "+(0,s.zw)(n.msg.onTime[0].minutes),1)])):"recipient"===n.status?((0,o.wg)(),(0,o.iD)("div",c,[(0,o._)("b",null,(0,s.zw)(n.msg.provider),1),(0,o.Uk)(" - "+(0,s.zw)(n.msg.header)+" ",1),(0,o.Wm)(h,{num:n.msg.onTime[0].month},null,8,["num"]),(0,o.Uk)(", "+(0,s.zw)(n.msg.onTime[0].day)+", "+(0,s.zw)(n.msg.onTime[0].year)+" kello "+(0,s.zw)(n.msg.onTime[0].hours)+" : "+(0,s.zw)(n.msg.onTime[0].minutes),1)])):(0,o.kq)("",!0)])]))}var g=n(4313),u=n(5253),h={name:"Info",props:{status:String,msg:String},components:{MDBBtnClose:g.Ok,monthConverter:u.Z},methods:{handleCloseInfo(){this.$emit("close:info")}}},k=n(89);const f=(0,k.Z)(h,[["render",m],["__scopeId","data-v-0a2a8d86"]]);var p=f},9245:function(e,i,n){n.r(i),n.d(i,{default:function(){return R}});var o=n(3396),s=n(7139);const t=e=>((0,o.dD)("data-v-e6c74b14"),e=e(),(0,o.Cn)(),e),l={key:0},r={key:1},a={key:0,class:"spinner-border",role:"status"},d=t((()=>(0,o._)("span",{class:"visually-hidden"},"Loading...",-1))),c=[d],m={key:1},g={key:0,id:"info-block"},u={class:"file-marker"},h=t((()=>(0,o._)("div",{class:"box-title"}," Kinnitatud broneeringud ",-1))),k={class:"box-contents"},f={key:0,id:"info-block-confirmed"},p={class:"file-marker"},w=t((()=>(0,o._)("div",{class:"box-title-confirmed"}," Broneering on ootel kui firma kinnitab ",-1))),v={class:"box-contents-confirmed"},B={key:1};function b(e,i,n,t,d,b){const C=(0,o.up)("recipientResult"),y=(0,o.up)("MDBCol"),_=(0,o.up)("bookingInfo"),D=(0,o.up)("MDBRow"),T=(0,o.up)("MDBBtn"),M=(0,o.up)("MDBContainer");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o.Wm)(M,{style:{"margin-top":"200px"}},{default:(0,o.w5)((()=>[d.isBooking?((0,o.wg)(),(0,o.iD)("div",l,[(0,o.Wm)(C,{booking:d.booking,bookingTime:d.recipientDateTime,providers:d.providerMatchByProfession,confirmedBookings:d.confirmedBookings,line:d.line,"onSet:order:to:send":b.handleOrderToSend,"onRemove:confirmed:provider":b.handleConfirmedProvider,"onCansel:result":b.handleCanselResult,onFinalinfo:b.finalinfo,chatusers:n.chatusers,messages:n.messages,onSelect:b.selectUser,onMessage:b.onMessage,onChatCredentials:b.chatCredentials,onFilter_provider:b.handleFilterProvider,onOtherUser:b.otherUser},null,8,["booking","bookingTime","providers","confirmedBookings","line","onSet:order:to:send","onRemove:confirmed:provider","onCansel:result","onFinalinfo","chatusers","messages","onSelect","onMessage","onChatCredentials","onFilter_provider","onOtherUser"])])):((0,o.wg)(),(0,o.iD)("div",r,[d.bookings?((0,o.wg)(),(0,o.iD)("div",m,[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,{md:"6"}),(0,o.Wm)(y,{md:"6"},{default:(0,o.w5)((()=>[d.confirmedBookings.length>0?((0,o.wg)(),(0,o.iD)("aside",g,[(0,o._)("section",u,[(0,o._)("div",null,[h,(0,o._)("div",k,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.confirmedBookings,(e=>((0,o.wg)(),(0,o.j4)(_,{key:e.id,status:"recipient",msg:e},null,8,["msg"])))),128))])])])])):(0,o.kq)("",!0)])),_:1})])),_:1}),(0,o._)("h3",null,"Sinulla on hetkellä - "+(0,s.zw)(d.bookings.length)+" - avointa tilausta:",1),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(d.bookings,(e=>((0,o.wg)(),(0,o.j4)(D,{key:e.id,class:"bookings"},{default:(0,o.w5)((()=>[d.clientConfirmedBookings.some((i=>i.id===e.id))?((0,o.wg)(),(0,o.iD)("aside",f,[(0,o._)("section",p,[(0,o._)("div",null,[w,(0,o._)("div",v,[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.date),1)])),_:2},1024),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.header),1)])),_:2},1024),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(T,{outline:"info",block:"",size:"lg",onClick:i=>b.handleRecipientResult(e.id),disabled:""},{default:(0,o.w5)((()=>[(0,o.Uk)("Tiedot")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])])])])):((0,o.wg)(),(0,o.iD)("aside",B,[(0,o.Wm)(D,null,{default:(0,o.w5)((()=>[(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.date),1)])),_:2},1024),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Uk)((0,s.zw)(e.header),1)])),_:2},1024),(0,o.Wm)(y,null,{default:(0,o.w5)((()=>[(0,o.Wm)(T,{outline:"info",block:"",size:"lg",onClick:i=>b.handleRecipientResult(e.id)},{default:(0,o.w5)((()=>[(0,o.Uk)("Tiedot")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)]))])),_:2},1024)))),128)),(0,o.Uk)(" ----------------------------------------------------------------- "),(0,o.Wm)(T,{outline:"info",block:"",size:"lg",onClick:b.newBooking},{default:(0,o.w5)((()=>[(0,o.Uk)("Teen uuden tilauksen")])),_:1},8,["onClick"]),(0,o.Wm)(T,{outline:"black",block:"",size:"lg",onClick:b.openMap},{default:(0,o.w5)((()=>[(0,o.Uk)("Asiantuntijoita ympärilläsi")])),_:1},8,["onClick"])])):((0,o.wg)(),(0,o.iD)("div",a,c))]))])),_:1})])}n(7658);var C=n(4313),y=n(4870),_=n(7227),D=n(9398),T=n(5800),M=n(7572),z=n(5253),U={name:"recipient-panel",props:{chatusers:Array,messages:Array,recipientBookings:Array},data(){return{bookings:[],provider:{},booking:null,d:null,confirmedBookings:[],clientConfirmedBookings:[],isBooking:!1,providerMatchByProfession:[],providerMatchingRequirements:null,line:"",recipientDateTime:null}},setup(){const e=(0,y.iH)(!1);return{isAvailable:e}},components:{bookingInfo:M.Z,recipientResult:_["default"],MDBBtn:C.$v,MDBContainer:C.L5,MDBRow:C.uZ,MDBCol:C.TK},async mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const i=JSON.parse(e);this.userId=i.id,this.provider=await D.Z.getProvider(i.id),this.handleRecipientBookings()}else this.$router.push("/")},methods:{selectUser(e){this.$emit("select:user",e)},onMessage(e,i){this.$emit("on:message",e,i)},otherUser(e){this.$emit("otherUser",e)},finalinfo(e){console.log("Data in recipient panel "+e),this.$emit("finalinfo",e)},chatCredentials(e){this.$emit("chatCredentials",e)},async handleRecipientBookings(){let e=await T.Z.getOwnBookings(this.userId);this.confirmedBookings=e.filter((e=>"confirmed"===e.status)),this.clientConfirmedBookings=e.filter((e=>"notSeen"===e.status||"seen"===e.status)),this.bookings=e.filter((e=>"confirmed"!==e.status))},async handleRecipientResult(e){console.log("Provider id is: "+e),this.booking=await T.Z.getBookingById(e),console.log("Profession: "+this.booking.map((e=>e.professional)));let i=[];i=this.booking[0].professional,this.booking.map((e=>{this.recipientDateTime=new Date(2023,e.onTime[0].month,e.onTime[0].day,e.onTime[0].hours,e.onTime[0].minutes),console.log("Recipient datetime: "+e.onTime[0].day)})),console.log("xxx "+this.recipientDateTime.getTime()),this.line=i[0],this.providerMatchByProfession=await D.Z.getProvidersMatchingByProfession({result:i});const n=(e,i)=>new Promise(((n,o)=>{e.getDistanceMatrix(i,((e,i)=>{"OK"===i?n(e):o(e)}))}));let o=[],s=[],t=this.booking[0].latitude,l=this.booking[0].longitude;o=[t,l],this.providerMatchByProfession.forEach((e=>{let i=e.latitude,t=e.longitude;s=[i,t];const l=async(e,i)=>{const o=new google.maps.LatLng(e[0],e[1]),s=new google.maps.LatLng(i[0],i[1]),t=new google.maps.DistanceMatrixService,l=await n(t,{origins:[o],destinations:[s],travelMode:"DRIVING"});return{distance:(l.rows[0].elements[0].distance.value/1e3).toFixed(1),duration:l.rows[0].elements[0].duration.text}};l(o,s).then((i=>{e.distance=i.distance,e.duration=i.duration}))})),console.log("xxxxxx "+this.providerMatchByProfession.length),this.isBooking=!0},handleFilterProvider(e){console.log("Filtering is working! "+e),"distance"===e&&this.providerMatchByProfession.sort(((e,i)=>e.distance-i.distance)),console.log("Filtering: "+this.providerMatchByProfession.map((e=>e.distance)))},handleOrderToSend(e){console.log("Order is sended "+e),this.clientConfirmedBookings=this.clientConfirmedBookings.concat(this.booking)},newBooking(){this.$router.push("/rf")},handleConfirmedProvider(e){this.providerMatchByProfession=this.providerMatchByProfession.filter((i=>i.id!==e))},openMap(){this.$router.push("/recipient-public")},compareTime(){console.log("Month is: "+z.Z.month(4))},handleCanselResult(e){console.log("Canseled: "+e),this.isBooking=e}}},W=n(89);const P=(0,W.Z)(U,[["render",b],["__scopeId","data-v-e6c74b14"]]);var R=P}}]);
//# sourceMappingURL=383.676104e9.js.map