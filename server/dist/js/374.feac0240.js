"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[374,324],{6876:function(e,i,o){o.d(i,{Z:function(){return v}});var n=o(3396),t=o(7139);const s={key:0},a={class:"waiting-info"},r={key:1},l={class:"info"},d={key:0},m={key:1};function c(e,i,o,c,g,u){const h=(0,n.up)("monthConverter"),k=(0,n.up)("MDBBtn");return"for-recipient"===o.status?((0,n.wg)(),(0,n.iD)("div",s,[(0,n._)("div",a,[(0,n.Uk)(" ( "),(0,n._)("b",null,(0,t.zw)(o.msg.ordered[0].yritys),1),(0,n.Uk)(" ) - "+(0,t.zw)(o.msg.header)+" - ",1),(0,n.Wm)(h,{num:o.msg.onTime[0].month},null,8,["num"]),(0,n.Uk)(", "+(0,t.zw)(o.msg.onTime[0].day)+", "+(0,t.zw)(o.msg.onTime[0].year)+" kello "+(0,t.zw)(o.msg.onTime[0].hours)+" : "+(0,t.zw)(o.msg.onTime[0].minutes)+" ",1),(0,n.Wm)(k,{block:"",outline:"warning",onClick:i[0]||(i[0]=e=>u.removeComplitedBookingPanel(o.msg))},{default:(0,n.w5)((()=>[(0,n.Uk)(" (Kustub muidu kui aeg läbi saab) - Saab eemaldada kohe (ajutine lahendus) ")])),_:1})])])):((0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("div",l,["for-provider"===o.status?((0,n.wg)(),(0,n.iD)("div",d,[(0,n._)("h2",null,[(0,n._)("b",null,(0,t.zw)(o.msg.header),1)]),(0,n.Uk)(" "+(0,t.zw)(o.msg.address)+" ",1),(0,n.Wm)(h,{num:o.msg.onTime[0].month},null,8,["num"]),(0,n.Uk)(", "+(0,t.zw)(o.msg.onTime[0].day)+", "+(0,t.zw)(o.msg.onTime[0].year)+" kello "+(0,t.zw)(o.msg.onTime[0].hours)+" : "+(0,t.zw)(o.msg.onTime[0].minutes),1)])):"recipient"===o.status?((0,n.wg)(),(0,n.iD)("div",m,[(0,n._)("b",null,(0,t.zw)(o.msg.provider),1),(0,n.Uk)(" - "+(0,t.zw)(o.msg.header)+" ",1),(0,n.Wm)(h,{num:o.msg.onTime[0].month},null,8,["num"]),(0,n.Uk)(", "+(0,t.zw)(o.msg.onTime[0].day)+", "+(0,t.zw)(o.msg.onTime[0].year)+" kello "+(0,t.zw)(o.msg.onTime[0].hours)+" : "+(0,t.zw)(o.msg.onTime[0].minutes),1)])):(0,n.kq)("",!0)])]))}var g=o(4313),u=o(5253),h={name:"Info",props:{status:String,msg:Object},components:{MDBBtn:g.$v,monthConverter:u.Z},methods:{removeCompletedBookingPro(e){this.$emit("remove:proConfirmed",e)},removeComplitedBookingPanel(e){this.$emit("remove:complitedBookingPanel",e)}}},k=o(89);const p=(0,k.Z)(h,[["render",c],["__scopeId","data-v-20e875e8"]]);var v=p},8485:function(e,i,o){o.r(i),o.d(i,{default:function(){return F}});var n=o(3396),t=o(7139);const s=e=>((0,n.dD)("data-v-630e8c1e"),e=e(),(0,n.Cn)(),e),a={key:0},r={key:1},l={key:0,class:"spinner-border",role:"status"},d=s((()=>(0,n._)("span",{class:"visually-hidden"},"Loading...",-1))),m=[d],c={key:1},g={key:0,id:"info-block"},u={class:"file-marker"},h=s((()=>(0,n._)("div",{class:"box-title"}," Vahvistetut varaukset! ",-1))),k={class:"box-contents"},p={class:"flex flex-wrap align-items-center justify-content-center"},v={class:"scalein animation-duration-3000 animation-iteration flex align-items-center justify-content-center font-bold w-full"},f={key:0,id:"info-block-confirmed"},w={class:"file-marker"},y=s((()=>(0,n._)("div",{class:"box-title-confirmed"}," Varaus on vireillä, kun yritys vahvistaa sen. ",-1))),B={class:"box-contents-confirmed"},b={key:1};function C(e,i,o,s,d,C){const T=(0,n.up)("recipientResult"),D=(0,n.up)("bookingInfo"),_=(0,n.up)("MDBCol"),P=(0,n.up)("MDBRow"),R=(0,n.up)("MDBBtn"),I=(0,n.up)("live-chat"),U=(0,n.up)("MDBContainer");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(U,{style:{"margin-top":"50px"}},{default:(0,n.w5)((()=>[d.isBooking?((0,n.wg)(),(0,n.iD)("div",a,[(0,n.Wm)(T,{test:o.test,booking:d.booking,images:d.images,bookingTime:d.recipientDateTime,providers:d.providerMatchByProfession,confirmedBookings:d.confirmedBookings,line:d.line,onUpdateBookingDate:C.handleUpdateBookingDate,"onSet:order:to:send":C.handleOrderToSend,"onRemove:confirmed:provider":C.handleConfirmedProvider,onRemoveBooking:C.handleRemoveBooking,"onCansel:result":C.handleCanselResult,onEditDescription:C.handleEditDescription,onAddImage:C.handleAddImage,onEditImage:C.handleEditImage,onRemoveImage:C.handleRemoveImage,onFinalinfo:C.finalinfo,chatusers:o.chatusers,selecteduser:o.selecteduser,messages:o.messages,onSelect:C.selectUser,onNoSelect:C.noSelectUser,onMessage:C.onMessage,onChatCredentials:C.chatCredentials,onFilter_provider:C.handleFilterProvider,onOtherUser:C.otherUser},null,8,["test","booking","images","bookingTime","providers","confirmedBookings","line","onUpdateBookingDate","onSet:order:to:send","onRemove:confirmed:provider","onRemoveBooking","onCansel:result","onEditDescription","onAddImage","onEditImage","onRemoveImage","onFinalinfo","chatusers","selecteduser","messages","onSelect","onNoSelect","onMessage","onChatCredentials","onFilter_provider","onOtherUser"])])):((0,n.wg)(),(0,n.iD)("div",r,[d.isSpinner?((0,n.wg)(),(0,n.iD)("div",l,m)):((0,n.wg)(),(0,n.iD)("div",c,[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,{md:"8"},{default:(0,n.w5)((()=>[o.confirmedBookingsByProvider.length>0?((0,n.wg)(),(0,n.iD)("aside",g,[(0,n._)("section",u,[(0,n._)("div",null,[h,(0,n._)("div",k,[(0,n._)("div",p,[(0,n._)("div",v,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.confirmedBookingsByProvider,(e=>((0,n.wg)(),(0,n.j4)(D,{key:e.id,status:"for-recipient",msg:e,"onRemove:complitedBookingPanel":C.handleRemoveComplitedBookingPanel},null,8,["msg","onRemove:complitedBookingPanel"])))),128))])])])])])])):(0,n.kq)("",!0)])),_:1}),(0,n.Wm)(_,{style:{padding:"20px 5px 20px 5px"},md:"4"},{default:(0,n.w5)((()=>[(0,n._)("h3",null,"Sinulla on hetkellä - "+(0,t.zw)(o.recipientBookings.length)+" - avointa tilausta:",1)])),_:1})])),_:1}),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.recipientBookings,((e,i)=>((0,n.wg)(),(0,n.j4)(P,{key:i,class:"bookings"},{default:(0,n.w5)((()=>[o.confirmedBookingsByClient.some((i=>i.id===e.id))?((0,n.wg)(),(0,n.iD)("aside",f,[(0,n._)("section",w,[(0,n._)("div",null,[y,(0,n._)("div",B,[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,t.zw)(e.date),1)])),_:2},1024),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,t.zw)(e.header),1)])),_:2},1024),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[d.isChat?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(R,{key:0,outline:"info",block:"",size:"lg",onClick:o=>C.contactToProvider(e,i)},{default:(0,n.w5)((()=>[(0,n.Uk)("Ava chat")])),_:2},1032,["onClick"])),d.isChat?((0,n.wg)(),(0,n.j4)(R,{key:1,outline:"danger",block:"",size:"lg",onClick:C.bookingWaitingProBackBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("Poistu")])),_:1},8,["onClick"])):(0,n.kq)("",!0)])),_:2},1024)])),_:2},1024),(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_),(0,n.Wm)(_,{style:{"text-align":"center"}},{default:(0,n.w5)((()=>[d.selectedIndex===i&&d.isChat?((0,n.wg)(),(0,n.j4)(I,{key:0,chatusers:o.chatusers,messages:o.messages,selecteduser:o.selecteduser,"onSelect:user":C.selectUser,onNoSelected:C.noSelectUser,"onOn:message":C.onMessage},null,8,["chatusers","messages","selecteduser","onSelect:user","onNoSelected","onOn:message"])):(0,n.kq)("",!0)])),_:2},1024),(0,n.Wm)(_)])),_:2},1024)])])])])):((0,n.wg)(),(0,n.iD)("aside",b,[(0,n.Wm)(P,null,{default:(0,n.w5)((()=>[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,t.zw)(e.date),1)])),_:2},1024),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,t.zw)(e.header),1)])),_:2},1024),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(R,{outline:"info",block:"",size:"lg",onClick:i=>C.handleRecipientResult(e.id,e)},{default:(0,n.w5)((()=>[(0,n.Uk)("Tiedot")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)]))])),_:2},1024)))),128)),(0,n.Wm)(R,{outline:"info",block:"",size:"lg",onClick:C.newBooking},{default:(0,n.w5)((()=>[(0,n.Uk)("Teen uuden tilauksen")])),_:1},8,["onClick"])]))])),(0,n.Uk)(" --------------------------------- ")])),_:1}),(0,n.Uk)(" Images "+(0,t.zw)(d.images),1)])}o(7658);var T=o(4313),D=o(4870),_=o(1176),P=o(8797),R=o(827),I=o(9398),U=o(5800),M=o(6876),z=o(5253),S=o(4058),x={name:"recipient-panel",props:{test:Boolean,chatusers:Array,selecteduser:null,messages:Array,recipientTest:null,recipientBookings:Array,confirmedBookingsByClient:Array,confirmedBookingsByProvider:Array},data(){return{id:"",isSpinner:!1,images:[],userId:null,bookings:this.recipientBookings,provider:{},booking:null,isChat:!1,currentRoom:"",selectedIndex:null,d:null,confirmedBookings:[],clientConfirmedBookings:[],isBooking:!1,providerMatchByProfession:[],providerMatchingRequirements:null,line:"",recipientDateTime:null,providersAvailable:[],providersBusy:[]}},setup(){const e=(0,D.iH)(!1);return{isAvailable:e}},components:{liveChat:_["default"],bookingInfo:M.Z,recipientResult:R["default"],MDBBtn:T.$v,MDBContainer:T.L5,MDBRow:T.uZ,MDBCol:T.TK},async mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const i=JSON.parse(e);this.userId=i.id,this.provider=await I.Z.getProvider(i.id),this.handleRecipientBookings()}else this.$router.push("/")},methods:{handleUpdateBookingDate(e){this.recipientDateTime=new Date(e.year,e.month,e.day,e.hours,e.minutes),console.log("recipient date time "+this.recipientDateTime)},selectUser(e){this.$emit("select:user",e)},noSelectUser(){this.$emit("noSelected")},onMessage(e,i){this.$emit("on:message",e,i)},bookingWaitingProBackBtn(){this.$emit("bookingWaitingProBack"),this.noSelectUser(),this.isChat=!1},async contactToProvider(e,i){await U.Z.getOwnBookings(this.userId);let o="";o=e.ordered.length>0?e.ordered[0].yritys+e.user.username:this.currentRoom,console.log("room xxx "+o),S.Z.emit("update room",o),this.selectedIndex=i,this.isChat=!0},otherUser(e){this.$emit("otherUser",e)},finalinfo(e){console.log("Data in recipient panel "+e),this.$emit("finalinfo",e)},chatCredentials(e){this.$emit("chatCredentials",e)},async handleRecipientBookings(){let e=await U.Z.getOwnBookings(this.userId);this.confirmedBookings=e.filter((e=>"confirmed"===e.status)),this.clientConfirmedBookings=e.filter((e=>"notSeen"===e.status||"seen"===e.status)),this.recipientBookings>0&&(this.recipientBookings[0].onTime.month||(this.isSpinner=!0))},async handleRecipientResult(e,i){console.log("Provider id is: "+e),this.booking=i,this.booking.image&&(this.images=this.booking.image),console.log("Profession: "+this.booking.professional);let o=[];o=this.booking.professional,console.log("Professional length "+this.booking.professional.length),this.recipientDateTime=new Date(i.onTime[0].year,i.onTime[0].month,i.onTime[0].day,i.onTime[0].hours,i.onTime[0].minutes),console.log("Recipient datetime: "+i.onTime[0].day),console.log("xxx "+this.recipientDateTime.getTime()),this.line=o[0],this.providerMatchByProfession=await I.Z.getProvidersMatchingByProfession({result:o}),this.providerMatchByProfession=this.providerMatchByProfession.filter((e=>e.user.id!==this.userId));const n=(e,i)=>new Promise(((o,n)=>{e.getDistanceMatrix(i,((e,i)=>{"OK"===i?o(e):n(e)}))}));let t=[],s=[],a=i.latitude,r=i.longitude;t=[a,r],this.providerMatchByProfession.forEach((e=>{let i=e.latitude,o=e.longitude;s=[i,o];const a=async(e,i)=>{const o=new google.maps.LatLng(e[0],e[1]),t=new google.maps.LatLng(i[0],i[1]),s=new google.maps.DistanceMatrixService,a=await n(s,{origins:[o],destinations:[t],travelMode:"DRIVING"});return{distance:(a.rows[0].elements[0].distance.value/1e3).toFixed(1),duration:a.rows[0].elements[0].duration.text}};a(t,s).then((i=>{e.distance=i.distance,e.duration=i.duration}))})),this.isBooking=!0},handleFilterProvider(e){console.log("Filtering is working! "+e),"distance"===e?this.providerMatchByProfession.sort(((e,i)=>e.distance-i.distance)):"rating"===e&&this.providerMatchByProfession.sort(((e,i)=>e.rating.positive-i.rating.positive)),this.handleFilterAvailability()},handleFilterByFeedback(){console.log("By feedback")},handleFilterAvailability(){console.log("Heyy here"),this.providerMatchByProfession.forEach((e=>{console.log("Recipient time "+this.recipientDateTime),e.timeoffer?e.timeoffer.forEach((i=>{P.Z.providerMatchingForClient(this.recipientDateTime,{y:i.yearFrom,m:i.monthFrom,d:i.dayFrom,hour:i.hoursFrom,min:i.minutesFrom},{y:i.yearTo,m:i.monthTo,d:i.dayTo,hour:i.hoursTo,min:i.minutesTo})?(console.log("Is available "+e.yritys),this.providersAvailable.push(e)):(console.log("Is not available provider yritys "+e.yritys),this.providersBusy.push(e))})):console.log("Not timeoffer setted")})),console.log("Available length "+this.providersAvailable.length),console.log("Not available length "+this.providersBusy.length)},handleOrderToSend(e){console.log("Order is sended "+e.id),this.$emit("update:booking",e.id),this.clientConfirmedBookings=this.clientConfirmedBookings.concat(this.booking)},newBooking(){this.$router.push("/rf")},handleConfirmedProvider(e,i,o){this.currentRoom=o.room,this.providerMatchByProfession=this.providerMatchByProfession.filter((i=>i.id!==e)),this.$emit("setNavbarChatUser",i,o),console.log("nb chat user start "+o.name),this.isBooking=!1},openMap(){const e="Tehnika 1-5, Antsla";this.$router.push("/recipient-public",{params:e})},compareTime(){console.log("Month is: "+z.Z.month(4))},removeConfirmationNotification(){},handleEditDescription(e){this.booking.description=e},async handleAddImage(e,i){console.log("Image id in upload "+e._id),console.log("Image image in upload "+e.image),console.log("Image name in upload "+e.name),this.$emit("addImageToRecipientBookings",e,i),this.images=[...this.images,e]},handleEditImage(e,i,o){-1!==e&&(this.images[e]={_id:i,blob:o})},async handleRemoveImage(e){this.images.splice(e,1),console.log("Image removed from array")},handleCanselResult(e){console.log("Canseled: "+e),this.isBooking=e},async handleRemoveComplitedBookingPanel(e){console.log("Removed complited booking "+e.id),console.log("Provider data +++ id "+e.ordered[0].id),console.log("Provider data +++ recipient userID "+e.ordered[0].user.id),this.$emit("setNavbarFeedbackNotification",e),await U.Z.updateRecipient(e.id,{status:"completed"})},async handleRemoveBooking(e){console.log("Removing booking id "+e),this.isBooking=!1,this.$emit("removeRecipient",e)}}},W=o(89);const A=(0,W.Z)(x,[["render",C],["__scopeId","data-v-630e8c1e"]]);var F=A}}]);
//# sourceMappingURL=374.feac0240.js.map