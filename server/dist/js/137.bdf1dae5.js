"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[137,191],{4304:function(e,i,o){o.d(i,{A:function(){return C}});var n=o(6768),t=o(4232);const s={key:0},l={class:"waiting-info"},a={key:0},r={key:1},d={key:1},u={class:"pro-info"},c={style:{float:"right"}},m={key:0},g={key:1},k={key:0,colspan:"2"},h={key:1,colspan:"2"};function p(e,i,o,p,v,f){const y=(0,n.g2)("monthConverter"),B=(0,n.g2)("MDBBtn"),b=(0,n.g2)("MDBTable");return"for-recipient"===o.status?((0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("div",l,[i[2]||(i[2]=(0,n.eW)(" ( ")),(0,n.Lk)("b",null,(0,t.v_)(o.msg.ordered[0].yritys),1),(0,n.eW)(" ) - "+(0,t.v_)(o.msg.header),1),i[3]||(i[3]=(0,n.Lk)("br",null,null,-1)),(0,n.bF)(y,{num:o.msg.onTime[0].month},null,8,["num"]),(0,n.eW)(" "+(0,t.v_)(o.msg.onTime[0].day)+" / "+(0,t.v_)(o.msg.onTime[0].year),1),i[4]||(i[4]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)(" klo "+(0,t.v_)(o.msg.onTime[0].hours)+" : "+(0,t.v_)(o.msg.onTime[0].minutes),1),i[5]||(i[5]=(0,n.Lk)("br",null,null,-1)),0===o.msg.ordered[0].range?((0,n.uX)(),(0,n.CE)("p",a,(0,t.v_)(o.msg.ordered[0].yritys)+" odottaa sinua osoitteseen: "+(0,t.v_)(o.msg.ordered[0].address),1)):((0,n.uX)(),(0,n.CE)("p",r,(0,t.v_)(o.msg.ordered[0].yritys)+" tulossa sovittuun osoitteeseen!",1)),(0,n.bF)(B,{block:"",outline:"warning",onClick:i[0]||(i[0]=e=>f.removeComplitedBookingPanel(o.msg))},{default:(0,n.k6)((()=>i[1]||(i[1]=[(0,n.eW)(" (Kustub muidu kui aeg läbi saab) - Saab eemaldada kohe (ajutine lahendus) ")]))),_:1})])])):((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",u,[(0,n.Lk)("div",c,[(0,n.bF)(y,{num:o.msg.onTime[0].month},null,8,["num"]),(0,n.eW)(" "+(0,t.v_)(o.msg.onTime[0].day)+" / "+(0,t.v_)(o.msg.onTime[0].year),1),i[6]||(i[6]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)(" klo "+(0,t.v_)(o.msg.onTime[0].hours>=10?o.msg.onTime[0].hours:"0"+o.msg.onTime[0].hours)+" : "+(0,t.v_)(o.msg.onTime[0].minutes>=10?o.msg.onTime[0].minutes:"0"+o.msg.onTime[0].minutes),1)]),"for-provider"===o.status?((0,n.uX)(),(0,n.Wv)(b,{key:0,borderless:"",style:{"font-size":"18px",color:"#ddd","text-align":"left",padding:"10px",width:"100%"}},{default:(0,n.k6)((()=>[(0,n.Lk)("tbody",null,[(0,n.Lk)("tr",null,[i[7]||(i[7]=(0,n.Lk)("td",null," Sovittu: ",-1)),(0,n.Lk)("td",null,(0,t.v_)(o.msg.header),1)]),(0,n.Lk)("tr",null,[i[8]||(i[8]=(0,n.Lk)("td",null," Paikka: ",-1)),0===o.provider.range?((0,n.uX)(),(0,n.CE)("td",m,(0,t.v_)(o.provider.address),1)):((0,n.uX)(),(0,n.CE)("td",g,(0,t.v_)(o.msg.address),1))]),(0,n.Lk)("tr",null,[0===o.provider.range?((0,n.uX)(),(0,n.CE)("td",k,i[9]||(i[9]=[(0,n.Lk)("p",{style:{color:"deepskyblue"}}," Asiakas tulossa! ",-1)]))):((0,n.uX)(),(0,n.CE)("td",h,i[10]||(i[10]=[(0,n.Lk)("p",{style:{color:"deepskyblue"}}," Meno asiakkaan luonna! ",-1)])))])])])),_:1})):(0,n.Q3)("",!0)])]))}var v=o(5846),f=o(6765),y={name:"Info",props:{status:String,msg:Object,provider:Object},components:{MDBBtn:v.al,MDBTable:v.EU,monthConverter:f.A},methods:{removeCompletedBookingPro(e){this.$emit("remove:proConfirmed",e)},removeComplitedBookingPanel(e){this.$emit("remove:complitedBookingPanel",e)}}},B=o(1241);const b=(0,B.A)(y,[["render",p],["__scopeId","data-v-235bf50d"]]);var C=b},1943:function(e,i,o){o.r(i),o.d(i,{default:function(){return E}});var n=o(6768),t=o(4232);const s={key:0},l={key:1},a={key:0,class:"spinner-border",role:"status"},r={key:1},d={key:0,id:"info-block"},u={class:"file-marker"},c={class:"box-contents"},m={class:"flex flex-wrap align-items-center justify-content-center"},g={key:0,id:"info-block-confirmed"},k={class:"file-marker"},h={class:"box-title-confirmed"},p={class:"box-contents-confirmed"},v={class:"booking_time"},f={key:0},y={key:1},B={class:"booking_time"};function b(e,i,o,b,C,_){const T=(0,n.g2)("recipientResult"),I=(0,n.g2)("bookingInfo"),R=(0,n.g2)("MDBCol"),F=(0,n.g2)("MDBRow"),D=(0,n.g2)("MDBBtn"),M=(0,n.g2)("MDBTextarea"),w=(0,n.g2)("MDBContainer");return(0,n.uX)(),(0,n.CE)("div",null,[(0,n.bF)(w,{style:{"margin-top":"50px"}},{default:(0,n.k6)((()=>[C.isBooking?((0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(T,{test:o.test,booking:C.booking,images:C.images,bookingTime:C.recipientDateTime,providers:C.providerMatchByProfession,confirmedBookings:C.confirmedBookings,line:C.line,onUpdateBookingDate:_.handleUpdateBookingDate,"onSet:order:to:send":_.handleOrderToSend,"onClient:confirmed_provider":_.handleConfirmedProvider,onRemoveBooking:_.handleRemoveBooking,"onCansel:result":_.handleCanselResult,onEditDescription:_.handleEditDescription,onAddImage:_.handleAddImage,onEditImage:_.handleEditImage,onRemoveImage:_.handleRemoveImage,onFinalinfo:e.finalinfo,chatusers:o.chatusers,selecteduser:o.selecteduser,messages:o.messages,onSelect:_.selectUser,onNoSelect:_.noSelectUser,onMessage:_.onMessage,onInitializeChat:_.handleInitializeChat,onFilter_provider:_.handleFilterProvider,onOffer_confirmed:_.handleBookingConfirmed,onOtherUser:_.otherUser},null,8,["test","booking","images","bookingTime","providers","confirmedBookings","line","onUpdateBookingDate","onSet:order:to:send","onClient:confirmed_provider","onRemoveBooking","onCansel:result","onEditDescription","onAddImage","onEditImage","onRemoveImage","onFinalinfo","chatusers","selecteduser","messages","onSelect","onNoSelect","onMessage","onInitializeChat","onFilter_provider","onOffer_confirmed","onOtherUser"])])):((0,n.uX)(),(0,n.CE)("div",l,[C.isSpinner?((0,n.uX)(),(0,n.CE)("div",a,i[1]||(i[1]=[(0,n.Lk)("span",{class:"visually-hidden"},"Loading...",-1)]))):((0,n.uX)(),(0,n.CE)("div",r,[(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(R,{md:"8"},{default:(0,n.k6)((()=>[o.confirmedBookingsByProvider.length>0?((0,n.uX)(),(0,n.CE)("aside",d,[(0,n.Lk)("section",u,[(0,n.Lk)("div",null,[i[2]||(i[2]=(0,n.Lk)("div",{class:"box-title"}," Vahvistetut varaukset! ",-1)),(0,n.Lk)("div",c,[(0,n.Lk)("div",m,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.confirmedBookingsByProvider,(e=>((0,n.uX)(),(0,n.CE)("div",{key:e.id,class:"scalein animation-duration-3000 animation-iteration flex align-items-center justify-content-center font-bold w-full"},[(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(R,{sm:"12"},{default:(0,n.k6)((()=>[(0,n.bF)(I,{status:"for-recipient",msg:e,"onRemove:complitedBookingPanel":_.handleRemoveComplitedBookingPanel},null,8,["msg","onRemove:complitedBookingPanel"])])),_:2},1024)])),_:2},1024)])))),128))])])])])])):(0,n.Q3)("",!0)])),_:1}),(0,n.bF)(R,{style:{padding:"20px 5px 20px 5px"},md:"4"},{default:(0,n.k6)((()=>[(0,n.Lk)("h3",null,"Sinulla on hetkellä - "+(0,t.v_)(o.recipientBookings.length)+" - avointa tilausta:",1)])),_:1})])),_:1}),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(o.recipientBookings,((e,s)=>((0,n.uX)(),(0,n.Wv)(F,{key:s,class:"bookings"},{default:(0,n.k6)((()=>[o.confirmedBookingsByClient.some((i=>i.id===e.id))?((0,n.uX)(),(0,n.CE)("aside",g,[(0,n.Lk)("section",k,[(0,n.Lk)("div",null,[(0,n.Lk)("div",h,(0,t.v_)(e.isIncludeOffers?e.offers.length>0?e.offers.length+" tarjousta":"Ei vielä tarjouksia!":"Varaus on vierellä kun tarjoajaa vahvista sen"),1),(0,n.Lk)("div",p,[(0,n.bF)(F,null,{default:(0,n.k6)((()=>[(0,n.bF)(R,null,{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e.date)+" ",1),(0,n.Lk)("p",v," klo "+(0,t.v_)(e.onTime[0].hours>=10?e.onTime[0].hours:"0"+e.onTime[0].hours)+" : "+(0,t.v_)(e.onTime[0].minutes>=10?e.onTime[0].minutes:"0"+e.onTime[0].minutes),1)])),_:2},1024),(0,n.bF)(R,null,{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e.header),1)])),_:2},1024),(0,n.bF)(R,null,{default:(0,n.k6)((()=>[e.isIncludeOffers?((0,n.uX)(),(0,n.Wv)(D,{key:1,outline:"success",size:"lg",onClick:i=>_.handleRecipientResult(e.id,e)},{default:(0,n.k6)((()=>i[5]||(i[5]=[(0,n.eW)("Tilaus")]))),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.CE)("div",f,[s===C.selectedIndex?((0,n.uX)(),(0,n.Wv)(D,{key:0,outline:"danger",block:"",size:"lg",onClick:_.canselQuitSelectedBooking},{default:(0,n.k6)((()=>i[3]||(i[3]=[(0,n.eW)("Poistu")]))),_:1},8,["onClick"])):((0,n.uX)(),(0,n.Wv)(D,{key:1,color:"danger",onClick:e=>_.handleQuitSelectedBooking(s)},{default:(0,n.k6)((()=>i[4]||(i[4]=[(0,n.eW)("Keskeyttä tilaus")]))),_:2},1032,["onClick"]))]))])),_:2},1024)])),_:2},1024),C.selectedIndex!==s||e.isIncludeOffers?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(F,{key:0},{default:(0,n.k6)((()=>[(0,n.bF)(R,{lg:"8",style:{"text-align":"center"}},{default:(0,n.k6)((()=>[C.isQuitBooking?((0,n.uX)(),(0,n.Wv)(M,{key:0,white:"",style:{},modelValue:C.clientQuitBookingReason,"onUpdate:modelValue":i[0]||(i[0]=e=>C.clientQuitBookingReason=e),label:"Anna syy...",rows:"3"},null,8,["modelValue"])):(0,n.Q3)("",!0)])),_:1}),(0,n.bF)(R,{lg:"4"},{default:(0,n.k6)((()=>[C.isQuitBooking&&C.clientQuitBookingReason.length>3?((0,n.uX)(),(0,n.Wv)(D,{key:0,block:"",color:"success",size:"lg>",style:{"margin-top":"10px"},onClick:i=>_.clientRejectBooking(e)},{default:(0,n.k6)((()=>i[6]||(i[6]=[(0,n.eW)("Varmista")]))),_:2},1032,["onClick"])):(0,n.Q3)("",!0)])),_:2},1024)])),_:2},1024))])])])])):((0,n.uX)(),(0,n.CE)("aside",y,[(0,n.bF)(F,{class:(0,t.C4)({order_expired:e.created_ms-(new Date).getTime()<=0})},{default:(0,n.k6)((()=>[(0,n.bF)(R,null,{default:(0,n.k6)((()=>[(0,n.Lk)("span",{class:(0,t.C4)({date_expired:e.created_ms-(new Date).getTime()<=0})},(0,t.v_)(e.date),3),(0,n.Lk)("p",B," klo "+(0,t.v_)(e.onTime[0].hours>=10?e.onTime[0].hours:"0"+e.onTime[0].hours)+" : "+(0,t.v_)(e.onTime[0].minutes>=10?e.onTime[0].minutes:"0"+e.onTime[0].minutes),1)])),_:2},1024),(0,n.bF)(R,null,{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e.header),1)])),_:2},1024),(0,n.bF)(R,null,{default:(0,n.k6)((()=>[e.created_ms-(new Date).getTime()>0?((0,n.uX)(),(0,n.Wv)(D,{key:0,outline:"info",block:"",size:"lg",onClick:i=>_.handleRecipientResult(e.id,e)},{default:(0,n.k6)((()=>i[7]||(i[7]=[(0,n.eW)("Tilaus")]))),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.Wv)(D,{key:1,outline:"danger",block:"",size:"lg",onClick:i=>_.handleRecipientResult(e.id,e)},{default:(0,n.k6)((()=>i[8]||(i[8]=[(0,n.eW)("vanhentunut")]))),_:2},1032,["onClick"]))])),_:2},1024)])),_:2},1032,["class"])]))])),_:2},1024)))),128)),(0,n.bF)(D,{outline:"info",block:"",size:"lg",onClick:_.newBooking},{default:(0,n.k6)((()=>i[9]||(i[9]=[(0,n.eW)("Teen uuden tilauksen")]))),_:1},8,["onClick"])]))]))])),_:1})])}o(4114);var C=o(5846),_=o(144),T=o(6510),I=o(8405),R=o(3508),F=o(1769),D=o(407),M=o(4304),w=o(6765),x=o(1690),A={name:"recipient-panel",props:{test:Boolean,chatusers:Array,selecteduser:null,messages:Array,recipientTest:null,recipientBookings:Array,confirmedBookingsByClient:Array,confirmedBookingsByProvider:Array},data(){return{id:"",isSpinner:!1,images:[],userId:null,bookings:this.recipientBookings,provider:{},booking:null,isQuitBooking:!1,currentRoom:"",selectedIndex:null,isPressedQuit:!1,clientQuitBookingReason:"",d:null,confirmedBookings:[],clientConfirmedBookings:[],isBooking:!1,providerMatchByProfession:[],providerMatchingRequirements:null,line:"",recipientDateTime:null,providersAvailable:[],providersBusy:[]}},setup(){const e=(0,_.KR)(!1);return{isAvailable:e}},components:{liveChat:T["default"],bookingInfo:M.A,recipientResult:R["default"],MDBBtn:C.al,MDBContainer:C.Dj,MDBRow:C.gU,MDBCol:C.m6,MDBTextarea:C.QP,MDBBadge:C.nf},async mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const i=JSON.parse(e);this.userId=i.id,this.provider=await F.A.getProvider(i.id),this.handleRecipientBookings()}else this.$router.push("/")},methods:{handleBookingConfirmed(e){this.$emit("offer_confirmed",e)},async clientRejectBooking(e){const i=await D.A.getBookingById(e.id);console.log("Booking id "+e.id),console.log("Client reject booking send id: "+i.ordered[0].user.id);const o=i.ordered[0].yritys+e.user.username,n={status:"waiting"},t=await D.A.updateRecipient(e.id,n);console.log("Is booking status updated: "+t.status),this.$emit("reject:bookingByClient",i,i.ordered[0].id,o),x.A.emit("reject booking by client",{id:i.ordered[0].user.id,room:o,booking:e,reason:this.clientQuitBookingReason}),this.isQuitBooking=!1},handleUpdateBookingDate(e,i){this.recipientDateTime=new Date(i.year,i.month,i.day,i.hours,i.minutes),this.$emit("recipient:date_ms",e,new Date(i.year,i.month,i.day,i.hours,i.minutes).getTime()),console.log("recipient date time "+this.recipientDateTime)},handleQuitSelectedBooking(e){this.selectedIndex=e,console.log("Index "+e),console.log("Selected index "+this.selectedIndex),this.isQuitBooking=!0},canselQuitSelectedBooking(){this.isQuitBooking=!1,this.selectedIndex=null},selectUser(e){this.$emit("select:user",e)},noSelectUser(){this.$emit("noSelected")},onMessage(e,i){this.$emit("on:message",e,i)},otherUser(e){this.$emit("otherUser",e)},handleInitializeChat(e){this.$emit("initializeChat",e)},async handleRecipientBookings(){let e=await D.A.getOwnBookings(this.userId);this.confirmedBookings=e.filter((e=>"confirmed"===e.status)),this.clientConfirmedBookings=e.filter((e=>"notSeen"===e.status||"seen"===e.status)),this.recipientBookings>0&&(this.recipientBookings[0].onTime.month||(this.isSpinner=!0))},async handleRecipientResult(e,i){this.booking=i,this.booking.image&&(this.images=this.booking.image),console.log("Profession: "+this.booking.professional);let o=[];o=this.booking.professional,console.log("Professional length "+this.booking.professional.length),this.recipientDateTime=new Date(i.onTime[0].year,i.onTime[0].month,i.onTime[0].day,i.onTime[0].hours,i.onTime[0].minutes),console.log("Recipient datetime: "+i.onTime[0].day),console.log("xxx "+this.recipientDateTime.getTime()),this.line=o[0],this.providerMatchByProfession=await F.A.getProvidersMatchingByProfession({result:o}),this.providerMatchByProfession=this.providerMatchByProfession.filter((e=>e.user.id!==this.userId));const n=(e,i)=>new Promise(((o,n)=>{e.getDistanceMatrix(i,((e,i)=>{"OK"===i?o(e):n(e)}))}));let t=[],s=[],l=i.latitude,a=i.longitude;t=[l,a],this.providerMatchByProfession.forEach((e=>{let i=e.latitude,o=e.longitude;s=[i,o];const l=async(e,i)=>{const o=new google.maps.LatLng(e[0],e[1]),t=new google.maps.LatLng(i[0],i[1]),s=new google.maps.DistanceMatrixService,l=await n(s,{origins:[o],destinations:[t],travelMode:"DRIVING"});return{distance:(l.rows[0].elements[0].distance.value/1e3).toFixed(1),duration:l.rows[0].elements[0].duration.text}};l(t,s).then((i=>{e.distance=i.distance,e.duration=i.duration}))})),this.isBooking=!0},handleFilterProvider(e){console.log("Filtering is working! "+e),"distance"===e?this.providerMatchByProfession.sort(((e,i)=>e.distance-i.distance)):"rating"===e&&this.providerMatchByProfession.sort(((e,i)=>e.rating.positive-i.rating.positive)),this.handleFilterAvailability()},handleFilterByFeedback(){console.log("By feedback")},handleFilterAvailability(){console.log("Heyy here"),this.providerMatchByProfession.forEach((e=>{console.log("Recipient time "+this.recipientDateTime),e.timeoffer?e.timeoffer.forEach((i=>{I.A.providerMatchingForClient(this.recipientDateTime,{y:i.yearFrom,m:i.monthFrom,d:i.dayFrom,hour:i.hoursFrom,min:i.minutesFrom},{y:i.yearTo,m:i.monthTo,d:i.dayTo,hour:i.hoursTo,min:i.minutesTo})?(console.log("Is available "+e.yritys),this.providersAvailable.push(e)):(console.log("Is not available provider yritys "+e.yritys),this.providersBusy.push(e))})):console.log("Not timeoffer setted")})),console.log("Available length "+this.providersAvailable.length),console.log("Not available length "+this.providersBusy.length)},handleOrderToSend(e,i,o){console.log("Order is sended "+i.id),this.$emit("update:booking",i.id),this.clientConfirmedBookings=this.clientConfirmedBookings.concat(this.booking)},newBooking(){this.$router.push("/rf")},handleConfirmedProvider(e,i,o){this.currentRoom=o.room,this.providerMatchByProfession=this.providerMatchByProfession.filter((i=>i.id!==e)),this.$emit("setNavbarChatUser",i,o),console.log("nb chat user start "+o.name),this.isBooking=!1},openMap(){const e="Tehnika 1-5, Antsla";this.$router.push("/recipient-public",{params:e})},compareTime(){console.log("Month is: "+w.A.month(4))},removeConfirmationNotification(){},handleEditDescription(e){this.booking.description=e},async handleAddImage(e,i){console.log("Image id in upload "+e._id),console.log("Image image in upload "+e.image),console.log("Image name in upload "+e.name),this.$emit("addImageToRecipientBookings",e,i),this.images=[...this.images,e]},handleEditImage(e,i,o){-1!==e&&(this.images[e]={_id:i,blob:o})},async handleRemoveImage(e){this.images.splice(e,1),console.log("Image removed from array")},handleCanselResult(e){console.log("Canseled: "+e),this.isBooking=e},async handleRemoveComplitedBookingPanel(e){this.$emit("setNavbarAboutSetFeedback",e),x.A.emit("archive booking",{id:e.ordered[0].user.id,room:e.ordered[0].yritys+e.user.username,booking:e}),await D.A.updateRecipient(e.id,{status:"completed"})},async handleRemoveBooking(e){console.log("Removing booking id "+e),this.isBooking=!1,this.$emit("removeRecipient",e)}}},L=o(1241);const P=(0,L.A)(A,[["render",b],["__scopeId","data-v-86054aea"]]);var E=P}}]);
//# sourceMappingURL=137.bdf1dae5.js.map