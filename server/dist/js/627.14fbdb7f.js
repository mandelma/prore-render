"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[627],{1644:function(e,i,s){e.exports=s.p+"img/error.9510853e.png"},3627:function(e,i,s){s.r(i),s.d(i,{default:function(){return M}});var l=s(6768),a=s(4232);const t={class:"panel"},o=["src","alt"],n=["onClick"],d={key:0,class:"edit-panel"},r=["onChange"],g={for:"pro-upload",class:"pro-file-upload"},u={key:0},h={key:1},c=["src"],m={key:1,class:"add-panel"},p={for:"add-upload",class:"pro-file-upload"},k={key:0},f={key:1},v=["src"];function y(e,i,s,y,A,P){const b=(0,l.g2)("error-message"),I=(0,l.g2)("MDBBtnClose"),E=(0,l.g2)("MDBBtn"),w=(0,l.g2)("MDBCol"),_=(0,l.g2)("MDBRow"),C=(0,l.g2)("MDBContainer");return(0,l.uX)(),(0,l.Wv)(C,null,{default:(0,l.k6)((()=>[i[5]||(i[5]=(0,l.Lk)("h2",{style:{"margin-bottom":"27px"}},"Kuvat omista palveluista!",-1)),(0,l.bF)(_,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.proImages,((e,s)=>((0,l.uX)(),(0,l.Wv)(w,{lg:"4",key:s},{default:(0,l.k6)((()=>[(0,l.Lk)("div",t,[(0,l.Lk)("img",{class:"proRefLoading",src:e.blob?e.blob:e.imageUrl,alt:e.name},null,8,o),(0,l.Lk)("button",{class:"img_btn",onClick:e=>P.pressEditPanel(s)},"Muokkaa",8,n)]),A.isEditPanel&&A.imgIndex===s?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(b,{message:A.wrongSizeTypeMessage},null,8,["message"]),(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[A.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(I,{key:0,white:"",class:"close-btn",style:{float:"right"},onClick:P.closeEditPanel},null,8,["onClick"])),(0,l.Lk)("input",{id:"pro-upload",type:"file",onChange:e=>P.handleFileChange(e,s)},null,40,r),(0,l.Lk)("label",g,[A.value?((0,l.uX)(),(0,l.CE)("span",u," Muokka tehtävän kuvausta: "+(0,a.v_)(A.value.name),1)):((0,l.uX)(),(0,l.CE)("span",h,"Valitse uusi kuva tehtävästä"))]),A.isEdit?((0,l.uX)(),(0,l.Wv)(E,{key:1,block:"",color:"success",onClick:i=>P.editRefImage(s,e)},{default:(0,l.k6)((()=>i[1]||(i[1]=[(0,l.eW)("Upload edited image")]))),_:2},1032,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(E,{class:"btn",block:"",size:"lg",color:"danger",onClick:i=>P.removeRefImage(s,e)},{default:(0,l.k6)((()=>i[2]||(i[2]=[(0,l.eW)("Poista kuva")]))),_:2},1032,["onClick"])])),_:2},1024),A.value?((0,l.uX)(),(0,l.Wv)(w,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(I,{white:"",class:"close-btn",style:{float:"right"},onClick:P.closeEditPanel},null,8,["onClick"]),(0,l.Lk)("img",{style:{width:"100px","padding-top":"20px"},src:this.showImage,alt:"addEdit"},null,8,c)])),_:1})):(0,l.Q3)("",!0)])),_:2},1024)])):(0,l.Q3)("",!0)])),_:2},1024)))),128))])),_:1}),A.isPressedAdd?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(E,{key:0,block:"",color:"warning",onClick:P.pressAddImage,style:{"margin-top":"13px"}},{default:(0,l.k6)((()=>i[3]||(i[3]=[(0,l.eW)("Lisää uusi kuva tehtävästä")]))),_:1},8,["onClick"])),A.isPressedAdd&&A.isAddPanel?((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)(b,{message:A.wrongSizeTypeMessage},null,8,["message"]),(0,l.bF)(_,null,{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[A.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(I,{key:0,white:"",class:"close-btn",onClick:P.closeAddPanel},null,8,["onClick"])),(0,l.Lk)("input",{id:"add-upload",type:"file",onChange:i[0]||(i[0]=i=>P.handleFileChange(i,e.i))},null,32),(0,l.Lk)("label",p,[A.value?((0,l.uX)(),(0,l.CE)("span",k," Muokka tehtävän kuvausta: "+(0,a.v_)(A.value.name),1)):((0,l.uX)(),(0,l.CE)("span",f,"Valitse lisää kuva tehtävästä"))]),A.isAdd?((0,l.uX)(),(0,l.Wv)(E,{key:1,block:"",outline:"primary",onClick:P.addRefImage},{default:(0,l.k6)((()=>i[4]||(i[4]=[(0,l.eW)("Tallenna kuva")]))),_:1},8,["onClick"])):(0,l.Q3)("",!0)])),_:1}),A.value?((0,l.uX)(),(0,l.Wv)(w,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(I,{class:"close-btn",white:"",onClick:P.closeAddPanel},null,8,["onClick"]),(0,l.Lk)("img",{style:{width:"100px"},src:this.showImage,alt:"addShow"},null,8,v)])),_:1})):(0,l.Q3)("",!0)])),_:1})])):(0,l.Q3)("",!0)])),_:1})}s(8111),s(7588);var A=s(5846),P=(s(4474),s(5570)),b=s(1769),I=s(4482),E=s(1690),w=(s(407),{name:"ProGallery",props:{provider:null,proImages:Array},components:{errorMessage:I.A,MDBContainer:A.Dj,MDBRow:A.gU,MDBCol:A.m6,MDBBtn:A.al,MDBBtnClose:A.uR},data(){return{IMAGE_SIZE:1e6,value:null,showImage:null,files:null,imgIndex:null,isAdd:!1,isEdit:!1,isEditPanel:!1,isPressedAdd:!1,isAddPanel:!1,wrongSizeTypeMessage:null}},methods:{async sendReadableFileToRecipients(e,i){let s=[];this.provider.booking.forEach((e=>{console.log("Booking info "+e.user.username),s=[...s,e.user.id]}));const l=new FormData;l.append("file",this.files,this.files.name);const a=new FileReader;a.onload=l=>{const a=new Uint8Array(l.target.result);console.log("FILES IN gallery.... "+this.files),E.A.emit("created file for recipients",e,a,this.provider.id,s,i)},a.readAsArrayBuffer(this.files)},handleFileChange(e,i){this.imgIndex=i;try{const i=e.target.files[0];console.log("event target client ",e.target.files[0]),i&&(this.showImage=URL.createObjectURL(i),this.files=e.target.files[0],this.isAdd=!0,this.isEdit=!0)}catch(s){console.log("Error:",s)}this.value=e.target.files[0]},pressAddImage(){this.isAdd=!1,this.isEdit=!1,this.isEditPanel=!1,this.isPressedAdd=!0,this.isAddPanel=!0},pressEditPanel(e){this.isEdit=!1,this.value=null,this.imgIndex=e,this.isPressedAdd=!1,this.isEditPanel=!0,this.isAddPanel=!1},closeEditPanel(){this.isAddPanel=!1,this.isEditPanel=!1,this.isEdit=!1,this.value=null},closeAddPanel(){this.isAddPanel=!1,this.isPressedAdd=!1,this.value=null},async addRefImage(){this.value=null,this.isAddPanel=!1,this.isAdd=!1,this.isPressedAdd=!1;const e=new FormData;e.append("file",this.files,this.files.name),console.log("IMG pro size - "+this.files.size),console.log("Image pro type_ "+this.files.type),console.log("AAA "+this.provider.user.id);const i=this.files.type;if("image/jpeg"===i||"image/jpg"===i||"image/png"===i||"image/gif"===i)if(console.log("Pildi formaat on OK"),this.files.size<=this.IMAGE_SIZE){const i=await P.A.uploadProImage(e);if(i){console.log("Pro image id is: "+i.id),await b.A.addProSlide(this.provider.id,{slideID:i.id});const e={_id:i.id,key:i.key,blob:this.showImage};this.$emit("addProImage",e),await this.sendReadableFileToRecipients(i.id,"add"),this.isEdit=!1}}else console.log("Pildi suurus peab olema väiksem kui 1 MB"),this.isAddPanel=!0,this.isPressedAdd=!0,this.wrongSizeTypeMessage="Kuvan maximi koko on 3 MB.",setTimeout((()=>{this.wrongSizeTypeMessage=null}),3e3);else console.log("Pildi formaat on FAKE"),this.isAddPanel=!0,this.isPressedAdd=!0,this.wrongSizeTypeMessage="Väärä formaati. Kuva pitäisi olla jpeg, jpg, png tai gif formaatissa!",setTimeout((()=>{this.wrongSizeTypeMessage=null}),3e3)},async editRefImage(e,i){console.log("Edited image index is: "+e),this.isEditPanel=!1,this.isEdit=!1;const s=new FormData;s.append("file",this.files,this.files.name),console.log("Image id "+this.proImages[e]._id);const l=this.files.type;if("image/jpeg"===l||"image/jpg"===l||"image/png"===l||"image/gif"===l)if(this.files.size<=this.IMAGE_SIZE){console.log("Image id to edit "+this.proImages[e]._id);const l=await P.A.editProImage(i._id,i.key,s);l&&(console.log("Edited pro image key: "+l.key),this.$emit("editProRefImage",e,i._id,l.key,this.showImage),await this.sendReadableFileToRecipients(l.id,"edit"),this.file=null,this.isEditPanel=!1,this.closeAddPanel())}else this.isEditPanel=!0,this.closeAddPanel(),this.wrong_SizeType_Message="Väärä formaati. Kuva pitäisi olla jpeg, jpg, png tai gif formaatissa!",setTimeout((()=>{this.wrong_SizeType_Message=null}),3e3);else this.isEditPanel=!0,this.closeAddPanel(),this.wrong_SizeType_Message="Kuvan maximi koko on oltava 3 MB!",setTimeout((()=>{this.wrong_SizeType_Message=null}),3e3)},async removeRefImage(e,i){this.proImages[e].blob||console.log("removed image is blob");let s=[];this.provider.booking.forEach((e=>{console.log("Booking info -- removing "+e.user.username),s=[...s,e.user.id]})),console.log("removable image id is "+this.proImages[e]._id),await P.A.deleteImage(i._id,i.key),this.$emit("removeProRefImage",e),E.A.emit("remove recipient side pro ref image",i._id,this.provider.id,s),this.isEditPanel=!1}}}),_=s(1241);const C=(0,_.A)(w,[["render",y],["__scopeId","data-v-36438f50"]]);var M=C},4482:function(e,i,s){var l=s(6768);const a=({message:e})=>null===e?null:(0,l.bF)("div",{className:"error"},[e,(0,l.bF)("img",{className:"errorImg",alt:"error",src:s(1644)},null)]);i.A=a}}]);
//# sourceMappingURL=627.14fbdb7f.js.map