"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[152],{4482:function(e,i,s){var l=s(6768);const a=({message:e})=>null===e?null:(0,l.bF)("div",{className:"error"},[e,(0,l.bF)("img",{className:"errorImg",alt:"error",src:s(1644)},null)]);i.A=a},7152:function(e,i,s){s.r(i),s.d(i,{default:function(){return F}});var l=s(6768),a=s(4232);const t=["src"],o={class:"panel"},n=["src","alt"],d=["onClick"],r={key:0,class:"edit-panel"},g=["onChange"],u={for:"pro-upload",class:"pro-file-upload"},h={key:0},m={key:1},c=["src"],p={key:1,class:"add-panel"},f={for:"add-upload",class:"pro-file-upload"},k={key:0},v={key:1},A=["src"];function P(e,i,P,I,y,b){const _=(0,l.g2)("error-message"),E=(0,l.g2)("MDBBtnClose"),C=(0,l.g2)("MDBBtn"),w=(0,l.g2)("MDBCol"),M=(0,l.g2)("MDBRow"),F=(0,l.g2)("MDBContainer");return(0,l.uX)(),(0,l.Wv)(F,null,{default:(0,l.k6)((()=>[i[6]||(i[6]=(0,l.Lk)("h2",{style:{"margin-bottom":"27px"}},"Kuvat omista palveluista!",-1)),(0,l.bF)(M,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(P.proImages,((e,p)=>((0,l.uX)(),(0,l.Wv)(w,{lg:"4",key:p},{default:(0,l.k6)((()=>[(0,l.eW)(" img.name "+(0,a.v_)(e.name),1),i[3]||(i[3]=(0,l.Lk)("br",null,null,-1)),(0,l.eW)(" img.image "+(0,a.v_)(e.image)+" ",1),(0,l.Lk)("img",{src:e.image,alt:"test"},null,8,t),(0,l.Lk)("div",o,[(0,l.Lk)("img",{class:"proRefLoading",src:e.blob?e.blob:s(9298)(`./${e.name}`),alt:e.name},null,8,n),(0,l.Lk)("button",{class:"img_btn",onClick:e=>b.pressEditPanel(p)},"Muokkaa",8,d)]),y.isEditPanel&&y.imgIndex===p?((0,l.uX)(),(0,l.CE)("div",r,[(0,l.bF)(_,{message:y.wrongSizeTypeMessage},null,8,["message"]),(0,l.bF)(M,null,{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[y.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(E,{key:0,white:"",class:"close-btn",style:{float:"right"},onClick:b.closeEditPanel},null,8,["onClick"])),(0,l.Lk)("input",{id:"pro-upload",type:"file",onChange:e=>b.handleFileChange(e,p)},null,40,g),(0,l.Lk)("label",u,[y.value?((0,l.uX)(),(0,l.CE)("span",h," Muokka tehtävän kuvausta: "+(0,a.v_)(y.value.name),1)):((0,l.uX)(),(0,l.CE)("span",m,"Valitse uusi kuva tehtävästä"))]),y.isEdit?((0,l.uX)(),(0,l.Wv)(C,{key:1,block:"",color:"success",onClick:e=>b.editRefImage(p)},{default:(0,l.k6)((()=>i[1]||(i[1]=[(0,l.eW)("Upload edited image")]))),_:2},1032,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(C,{class:"btn",block:"",size:"lg",color:"danger",onClick:i=>b.removeRefImage(p,e._id)},{default:(0,l.k6)((()=>i[2]||(i[2]=[(0,l.eW)("Poista kuva")]))),_:2},1032,["onClick"])])),_:2},1024),y.value?((0,l.uX)(),(0,l.Wv)(w,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(E,{white:"",class:"close-btn",style:{float:"right"},onClick:b.closeEditPanel},null,8,["onClick"]),(0,l.Lk)("img",{style:{width:"100px","padding-top":"20px"},src:this.showImage,alt:"addEdit"},null,8,c)])),_:1})):(0,l.Q3)("",!0)])),_:2},1024)])):(0,l.Q3)("",!0)])),_:2},1024)))),128))])),_:1}),y.isPressedAdd?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(C,{key:0,block:"",color:"warning",onClick:b.pressAddImage,style:{"margin-top":"13px"}},{default:(0,l.k6)((()=>i[4]||(i[4]=[(0,l.eW)("Lisää uusi kuva tehtävästä")]))),_:1},8,["onClick"])),y.isPressedAdd&&y.isAddPanel?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.bF)(_,{message:y.wrongSizeTypeMessage},null,8,["message"]),(0,l.bF)(M,null,{default:(0,l.k6)((()=>[(0,l.bF)(w,null,{default:(0,l.k6)((()=>[y.value?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(E,{key:0,white:"",class:"close-btn",onClick:b.closeAddPanel},null,8,["onClick"])),(0,l.Lk)("input",{id:"add-upload",type:"file",onChange:i[0]||(i[0]=i=>b.handleFileChange(i,e.i))},null,32),(0,l.Lk)("label",f,[y.value?((0,l.uX)(),(0,l.CE)("span",k," Muokka tehtävän kuvausta: "+(0,a.v_)(y.value.name),1)):((0,l.uX)(),(0,l.CE)("span",v,"Valitse lisää kuva tehtävästä"))]),y.isAdd?((0,l.uX)(),(0,l.Wv)(C,{key:1,block:"",outline:"primary",onClick:b.addRefImage},{default:(0,l.k6)((()=>i[5]||(i[5]=[(0,l.eW)("Tallenna kuva")]))),_:1},8,["onClick"])):(0,l.Q3)("",!0)])),_:1}),y.value?((0,l.uX)(),(0,l.Wv)(w,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(E,{class:"close-btn",white:"",onClick:b.closeAddPanel},null,8,["onClick"]),(0,l.Lk)("img",{style:{width:"100px"},src:this.showImage,alt:"addShow"},null,8,A)])),_:1})):(0,l.Q3)("",!0)])),_:1})])):(0,l.Q3)("",!0),(0,l.eW)(" PROIMAGES "+(0,a.v_)(P.proImages),1)])),_:1})}s(6573),s(8100),s(7936),s(7467),s(4732),s(9577),s(8992),s(3949),s(4603),s(7566),s(8721);var I=s(5846),y=s(4474),b=s(1769),_=s(4482),E=s(1690),C=(s(407),{name:"ProGallery",props:{provider:null,proImages:Array},components:{errorMessage:_.A,MDBContainer:I.Dj,MDBRow:I.gU,MDBCol:I.m6,MDBBtn:I.al,MDBBtnClose:I.uR},data(){return{IMAGE_SIZE:1e6,value:null,showImage:null,files:null,imgIndex:null,isAdd:!1,isEdit:!1,isEditPanel:!1,isPressedAdd:!1,isAddPanel:!1,wrongSizeTypeMessage:null}},methods:{async sendReadableFileToRecipients(e,i){let s=[];this.provider.booking.forEach((e=>{console.log("Booking info "+e.user.username),s=[...s,e.user.id]}));const l=new FormData;l.append("file",this.files,this.files.name);const a=new FileReader;a.onload=l=>{const a=new Uint8Array(l.target.result);console.log("FILES IN gallery.... "+this.files),E.A.emit("created file for recipients",e,a,this.provider.id,s,i)},a.readAsArrayBuffer(this.files)},handleFileChange(e,i){this.imgIndex=i;try{const i=e.target.files[0];console.log("event target client ",e.target.files[0]),i&&(this.showImage=URL.createObjectURL(i),this.files=e.target.files[0],this.isAdd=!0,this.isEdit=!0)}catch(s){console.log("Error:",s)}this.value=e.target.files[0]},pressAddImage(){this.isAdd=!1,this.isEdit=!1,this.isEditPanel=!1,this.isPressedAdd=!0,this.isAddPanel=!0},pressEditPanel(e){this.isEdit=!1,this.value=null,this.imgIndex=e,this.isPressedAdd=!1,this.isEditPanel=!0,this.isAddPanel=!1},closeEditPanel(){this.isAddPanel=!1,this.isEditPanel=!1,this.isEdit=!1,this.value=null},closeAddPanel(){this.isAddPanel=!1,this.isPressedAdd=!1,this.value=null},async addRefImage(){this.value=null,this.isAddPanel=!1,this.isAdd=!1,this.isPressedAdd=!1;const e=new FormData;e.append("file",this.files,this.files.name),console.log("IMG pro size - "+this.files.size),console.log("Image pro type_ "+this.files.type),console.log("AAA "+this.provider.user.id);const i=this.files.type;if("image/jpeg"===i||"image/jpg"===i||"image/png"===i||"image/gif"===i)if(console.log("Pildi formaat on OK"),this.files.size<=this.IMAGE_SIZE){const i=await y.A.createProRefImg(this.provider.user.id,e);if(i){await b.A.addProSlide(this.provider.id,{slideID:i.imgCreated._id});const e={_id:i.imgCreated._id,blob:this.showImage};this.$emit("addProImage",e),this.sendReadableFileToRecipients(i.imgCreated._id,"add"),this.isEdit=!1}}else console.log("Pildi suurus peab olema väiksem kui 1 MB"),this.isAddPanel=!0,this.isPressedAdd=!0,this.wrongSizeTypeMessage="Kuvan maximi koko on 3 MB.",setTimeout((()=>{this.wrongSizeTypeMessage=null}),3e3);else console.log("Pildi formaat on FAKE"),this.isAddPanel=!0,this.isPressedAdd=!0,this.wrongSizeTypeMessage="Väärä formaati. Kuva pitäisi olla jpeg, jpg, png tai gif formaatissa!",setTimeout((()=>{this.wrongSizeTypeMessage=null}),3e3)},async editRefImage(e,i){console.log("Edited image index is: "+e),this.isEditPanel=!1,this.isEdit=!1;const s=new FormData;s.append("file",this.files,this.files.name),console.log("Image id "+this.proImages[e]._id);const l=this.files.type;if("image/jpeg"===l||"image/jpg"===l||"image/png"===l||"image/gif"===l)if(this.files.size<=this.IMAGE_SIZE){console.log("Image id to edit "+this.proImages[e]._id);const i=await y.A.editProRefImage(this.proImages[e]._id,s);i&&(this.$emit("editProRefImage",e,i._id,this.showImage),await this.sendReadableFileToRecipients(i._id,"edit"),this.file=null,this.isEditPanel=!1,this.closeAddPanel())}else this.isEditPanel=!0,this.closeAddPanel(),this.wrong_SizeType_Message="Väärä formaati. Kuva pitäisi olla jpeg, jpg, png tai gif formaatissa!",setTimeout((()=>{this.wrong_SizeType_Message=null}),3e3);else this.isEditPanel=!0,this.closeAddPanel(),this.wrong_SizeType_Message="Kuvan maximi koko on oltava 3 MB!",setTimeout((()=>{this.wrong_SizeType_Message=null}),3e3)},async removeRefImage(e,i){this.proImages[e].blob||console.log("removed image is blob");let s=[];this.provider.booking.forEach((e=>{console.log("Booking info -- removing "+e.user.username),s=[...s,e.user.id]})),console.log("removable image id is "+this.proImages[e]._id),await y.A.removeProRefImage(this.proImages[e]._id,this.provider.id),this.$emit("removeProRefImage",e),E.A.emit("remove recipient side pro ref image",i,this.provider.id,s),this.isEditPanel=!1}}}),w=s(1241);const M=(0,w.A)(C,[["render",P],["__scopeId","data-v-8498f3fe"]]);var F=M},1644:function(e,i,s){e.exports=s.p+"img/error.9510853e.png"}}]);
//# sourceMappingURL=152.c5acf163.js.map