"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[913,982],{6633:function(e,o,i){i.d(o,{Z:function(){return f}});var n=i(3396),s=i(7139);const t={key:0},l={class:"waiting-info"},a={key:1},r={class:"info"},d={key:0},c={key:1};function m(e,o,i,m,g,u){const h=(0,n.up)("monthConverter"),k=(0,n.up)("MDBBtnClose");return"for-recipient"===i.status?((0,n.wg)(),(0,n.iD)("div",t,[(0,n._)("div",l,[(0,n._)("b",null,(0,s.zw)(i.msg.provider),1),(0,n.Uk)(" - "+(0,s.zw)(i.msg.header)+" ",1),(0,n.Wm)(h,{num:i.msg.onTime[0].month},null,8,["num"]),(0,n.Uk)(", "+(0,s.zw)(i.msg.onTime[0].day)+", "+(0,s.zw)(i.msg.onTime[0].year)+" kello "+(0,s.zw)(i.msg.onTime[0].hours)+" : "+(0,s.zw)(i.msg.onTime[0].minutes),1)])])):((0,n.wg)(),(0,n.iD)("div",a,[(0,n._)("div",r,[(0,n.Wm)(k,{class:"closeConfirmedBooking",onClick:u.handleCloseInfo},null,8,["onClick"]),"for-provider"===i.status?((0,n.wg)(),(0,n.iD)("div",d,[(0,n._)("h2",null,[(0,n._)("b",null,(0,s.zw)(i.msg.header),1)]),(0,n.Uk)(" "+(0,s.zw)(i.msg.address)+" ",1),(0,n.Wm)(h,{num:i.msg.onTime[0].month},null,8,["num"]),(0,n.Uk)(", "+(0,s.zw)(i.msg.onTime[0].day)+", "+(0,s.zw)(i.msg.onTime[0].year)+" kello "+(0,s.zw)(i.msg.onTime[0].hours)+" : "+(0,s.zw)(i.msg.onTime[0].minutes),1)])):"recipient"===i.status?((0,n.wg)(),(0,n.iD)("div",c,[(0,n._)("b",null,(0,s.zw)(i.msg.provider),1),(0,n.Uk)(" - "+(0,s.zw)(i.msg.header)+" ",1),(0,n.Wm)(h,{num:i.msg.onTime[0].month},null,8,["num"]),(0,n.Uk)(", "+(0,s.zw)(i.msg.onTime[0].day)+", "+(0,s.zw)(i.msg.onTime[0].year)+" kello "+(0,s.zw)(i.msg.onTime[0].hours)+" : "+(0,s.zw)(i.msg.onTime[0].minutes),1)])):(0,n.kq)("",!0)])]))}var g=i(4313),u=i(5253),h={name:"Info",props:{status:String,msg:String},components:{MDBBtnClose:g.Ok,monthConverter:u.Z},methods:{handleCloseInfo(){this.$emit("close:info")}}},k=i(89);const p=(0,k.Z)(h,[["render",m],["__scopeId","data-v-49920980"]]);var f=p},485:function(e,o,i){i.r(o),i.d(o,{default:function(){return R}});var n=i(3396),s=i(7139);const t=e=>((0,n.dD)("data-v-10bf91de"),e=e(),(0,n.Cn)(),e),l={key:0},a={key:1},r={key:0,class:"spinner-border",role:"status"},d=t((()=>(0,n._)("span",{class:"visually-hidden"},"Loading...",-1))),c=[d],m={key:1},g={key:0,id:"info-block"},u={class:"file-marker"},h=t((()=>(0,n._)("div",{class:"box-title"}," Vahvistetut varaukset! ",-1))),k={class:"box-contents"},p={key:0,id:"info-block-confirmed"},f={class:"file-marker"},v=t((()=>(0,n._)("div",{class:"box-title-confirmed"}," Varaus on vireill채, kun yritys vahvistaa sen. ",-1))),w={class:"box-contents-confirmed"},y={key:1};function B(e,o,i,t,d,B){const b=(0,n.up)("recipientResult"),C=(0,n.up)("MDBCol"),D=(0,n.up)("bookingInfo"),T=(0,n.up)("MDBBtn"),_=(0,n.up)("MDBRow"),I=(0,n.up)("live-chat"),M=(0,n.up)("MDBContainer");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(M,{style:{"margin-top":"200px"}},{default:(0,n.w5)((()=>[d.isBooking?((0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(b,{booking:d.booking,images:d.images,bookingTime:d.recipientDateTime,providers:d.providerMatchByProfession,confirmedBookings:d.confirmedBookings,line:d.line,onUpdateBookingDate:B.handleUpdateBookingDate,"onSet:order:to:send":B.handleOrderToSend,"onRemove:confirmed:provider":B.handleConfirmedProvider,"onCansel:result":B.handleCanselResult,onEditDescription:B.handleEditDescription,onAddImage:B.handleAddImage,onEditImage:B.handleEditImage,onRemoveImage:B.handleRemoveImage,onFinalinfo:B.finalinfo,chatusers:i.chatusers,selecteduser:i.selecteduser,messages:i.messages,onSelect:B.selectUser,onNoSelect:B.noSelectUser,onMessage:B.onMessage,onChatCredentials:B.chatCredentials,onFilter_provider:B.handleFilterProvider,onOtherUser:B.otherUser},null,8,["booking","images","bookingTime","providers","confirmedBookings","line","onUpdateBookingDate","onSet:order:to:send","onRemove:confirmed:provider","onCansel:result","onEditDescription","onAddImage","onEditImage","onRemoveImage","onFinalinfo","chatusers","selecteduser","messages","onSelect","onNoSelect","onMessage","onChatCredentials","onFilter_provider","onOtherUser"])])):((0,n.wg)(),(0,n.iD)("div",a,[0===d.bookings.length&&0===d.confirmedBookings.length?((0,n.wg)(),(0,n.iD)("div",r,c)):((0,n.wg)(),(0,n.iD)("div",m,[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(C,{md:"6"}),(0,n.Wm)(C,{md:"6"},{default:(0,n.w5)((()=>[d.confirmedBookings.length>0?((0,n.wg)(),(0,n.iD)("aside",g,[(0,n._)("section",u,[(0,n._)("div",null,[h,(0,n._)("div",k,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(d.confirmedBookings,(e=>((0,n.wg)(),(0,n.j4)(D,{key:e.id,status:"for-recipient",msg:e},null,8,["msg"])))),128)),(0,n.Wm)(T,{color:"danger",onClick:B.removeConfirmationNotification},{default:(0,n.w5)((()=>[(0,n.Uk)(" Kustuta teade ")])),_:1},8,["onClick"])])])])])):(0,n.kq)("",!0)])),_:1})])),_:1}),(0,n._)("h3",null,"Sinulla on hetkell채 - "+(0,s.zw)(d.bookings.length)+" - avointa tilausta:",1),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(d.bookings,((e,o)=>((0,n.wg)(),(0,n.j4)(_,{key:e.id,class:"bookings"},{default:(0,n.w5)((()=>[d.clientConfirmedBookings.some((o=>o.id===e.id))?((0,n.wg)(),(0,n.iD)("aside",p,[(0,n._)("section",f,[(0,n._)("div",null,[v,(0,n._)("div",w,[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(C,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.date),1)])),_:2},1024),(0,n.Wm)(C,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.header),1)])),_:2},1024),(0,n.Wm)(C,null,{default:(0,n.w5)((()=>[d.isChat?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(T,{key:0,outline:"secondary",block:"",size:"lg",onClick:i=>B.contactToProvider(e,o)},{default:(0,n.w5)((()=>[(0,n.Uk)("Ava chat")])),_:2},1032,["onClick"])),d.isChat?((0,n.wg)(),(0,n.j4)(T,{key:1,outline:"danger",block:"",size:"lg",onClick:B.bookingWaitingProBackBtn},{default:(0,n.w5)((()=>[(0,n.Uk)("Poistu")])),_:1},8,["onClick"])):(0,n.kq)("",!0)])),_:2},1024)])),_:2},1024),(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(C),(0,n.Wm)(C,{style:{"text-align":"center"}},{default:(0,n.w5)((()=>[d.selectedIndex===o&&d.isChat?((0,n.wg)(),(0,n.j4)(I,{key:0,chatusers:i.chatusers,messages:i.messages,selecteduser:i.selecteduser,"onSelect:user":B.selectUser,onNoSelected:B.noSelectUser,"onOn:message":B.onMessage},null,8,["chatusers","messages","selecteduser","onSelect:user","onNoSelected","onOn:message"])):(0,n.kq)("",!0)])),_:2},1024),(0,n.Wm)(C)])),_:2},1024)])])])])):((0,n.wg)(),(0,n.iD)("aside",y,[(0,n.Wm)(_,null,{default:(0,n.w5)((()=>[(0,n.Wm)(C,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.date),1)])),_:2},1024),(0,n.Wm)(C,null,{default:(0,n.w5)((()=>[(0,n.Uk)((0,s.zw)(e.header),1)])),_:2},1024),(0,n.Wm)(C,null,{default:(0,n.w5)((()=>[(0,n.Wm)(T,{outline:"info",block:"",size:"lg",onClick:o=>B.handleRecipientResult(e.id)},{default:(0,n.w5)((()=>[(0,n.Uk)("Tiedot")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)]))])),_:2},1024)))),128)),(0,n.Wm)(T,{outline:"info",block:"",size:"lg",onClick:B.newBooking},{default:(0,n.w5)((()=>[(0,n.Uk)("Teen uuden tilauksen")])),_:1},8,["onClick"]),(0,n.Wm)(T,{outline:"black",block:"",size:"lg",onClick:B.openMap},{default:(0,n.w5)((()=>[(0,n.Uk)("Asiantuntijoita ymp채rill채si")])),_:1},8,["onClick"])]))]))])),_:1})])}i(7658);var b=i(4313),C=i(4870),D=i(2753),T=i(8797),_=i(2710),I=i(9398),M=i(5800),U=i(6633),P=i(5253),z=i(4058),W={name:"recipient-panel",props:{chatusers:Array,selecteduser:null,messages:Array,recipientBookings:Array},data(){return{images:[],userId:null,bookings:[],provider:{},booking:null,isChat:!1,selectedIndex:null,d:null,confirmedBookings:[],clientConfirmedBookings:[],isBooking:!1,providerMatchByProfession:[],providerMatchingRequirements:null,line:"",recipientDateTime:null,providersAvailable:[],providersBusy:[]}},setup(){const e=(0,C.iH)(!1);return{isAvailable:e}},components:{liveChat:D["default"],bookingInfo:U.Z,recipientResult:_["default"],MDBBtn:b.$v,MDBContainer:b.L5,MDBRow:b.uZ,MDBCol:b.TK},async mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const o=JSON.parse(e);this.userId=o.id,this.provider=await I.Z.getProvider(o.id),this.handleRecipientBookings()}else this.$router.push("/")},methods:{handleUpdateBookingDate(e){this.recipientDateTime=new Date(e.year,e.month,e.day,e.hours,e.minutes),console.log("recipient date time "+this.recipientDateTime)},selectUser(e){this.$emit("select:user",e)},noSelectUser(){this.$emit("noSelected")},onMessage(e,o){this.$emit("on:message",e,o)},bookingWaitingProBackBtn(){this.$emit("bookingWaitingProBack"),this.noSelectUser(),this.isChat=!1},contactToProvider(e,o){console.log("Contact "+o),console.log("room xxx "+e.ordered[0].yritys);const i=e.ordered[0].yritys+e.user.username;z.Z.emit("update room",i),this.selectedIndex=o,this.isChat=!0},otherUser(e){this.$emit("otherUser",e)},finalinfo(e){console.log("Data in recipient panel "+e),this.$emit("finalinfo",e)},chatCredentials(e){this.$emit("chatCredentials",e)},async handleRecipientBookings(){let e=await M.Z.getOwnBookings(this.userId);this.confirmedBookings=e.filter((e=>"confirmed"===e.status)),this.clientConfirmedBookings=e.filter((e=>"notSeen"===e.status||"seen"===e.status)),this.bookings=e.filter((e=>"confirmed"!==e.status&&"completed"!==e.status))},async handleRecipientResult(e){console.log("Provider id is: "+e),this.booking=await M.Z.getBookingById(e),this.images=this.booking[0].image,console.log("Profession: "+this.booking.map((e=>e.professional)));let o=[];o=this.booking[0].professional,console.log("Professional length "+this.booking[0].professional.length),this.booking.map((e=>{this.recipientDateTime=new Date(e.onTime[0].year,e.onTime[0].month,e.onTime[0].day,e.onTime[0].hours,e.onTime[0].minutes),console.log("Recipient datetime: "+e.onTime[0].day)})),console.log("xxx "+this.recipientDateTime.getTime()),this.line=o[0],this.providerMatchByProfession=await I.Z.getProvidersMatchingByProfession({result:o}),console.log("Pro user id "+this.providerMatchByProfession.map((e=>e.user?e.user.id!==this.userId:"EI ole kasutajat???")));const i=(e,o)=>new Promise(((i,n)=>{e.getDistanceMatrix(o,((e,o)=>{"OK"===o?i(e):n(e)}))}));let n=[],s=[],t=this.booking[0].latitude,l=this.booking[0].longitude;n=[t,l],this.providerMatchByProfession.forEach((e=>{let o=e.latitude,t=e.longitude;s=[o,t];const l=async(e,o)=>{const n=new google.maps.LatLng(e[0],e[1]),s=new google.maps.LatLng(o[0],o[1]),t=new google.maps.DistanceMatrixService,l=await i(t,{origins:[n],destinations:[s],travelMode:"DRIVING"});return{distance:(l.rows[0].elements[0].distance.value/1e3).toFixed(1),duration:l.rows[0].elements[0].duration.text}};l(n,s).then((o=>{e.distance=o.distance,e.duration=o.duration}))})),console.log("xxxxxx "+this.providerMatchByProfession.length),this.isBooking=!0},handleFilterProvider(e){console.log("Filtering is working! "+e),"distance"===e?this.providerMatchByProfession.sort(((e,o)=>e.distance-o.distance)):"rating"===e&&this.providerMatchByProfession.sort(((e,o)=>e.rating.positive-o.rating.positive)),this.handleFilterAvailability()},handleFilterByFeedback(){console.log("By feedback")},handleFilterAvailability(){console.log("Heyy here"),this.providerMatchByProfession.forEach((e=>{console.log("Recipient time "+this.recipientDateTime),e.timeoffer?e.timeoffer.forEach((o=>{T.Z.providerMatchingForClient(this.recipientDateTime,{y:o.yearFrom,m:o.monthFrom,d:o.dayFrom,hour:o.hoursFrom,min:o.minutesFrom},{y:o.yearTo,m:o.monthTo,d:o.dayTo,hour:o.hoursTo,min:o.minutesTo})?(console.log("Is available "+e.yritys),this.providersAvailable.push(e)):(console.log("Is not available provider yritys "+e.yritys),this.providersBusy.push(e))})):console.log("Not timeoffer setted")})),console.log("Available length "+this.providersAvailable.length),console.log("Not available length "+this.providersBusy.length)},handleOrderToSend(e){console.log("Order is sended "+e),this.clientConfirmedBookings=this.clientConfirmedBookings.concat(this.booking)},newBooking(){this.$router.push("/rf")},handleConfirmedProvider(e){this.providerMatchByProfession=this.providerMatchByProfession.filter((o=>o.id!==e))},openMap(){const e="Tehnika 1-5, Antsla";this.$router.push("/recipient-public",{params:e})},compareTime(){console.log("Month is: "+P.Z.month(4))},removeConfirmationNotification(){},handleEditDescription(e){this.booking[0].description=e},async handleAddImage(e){console.log("Image id in upload "+e._id),console.log("Image image in upload "+e.image),console.log("Image name in upload "+e.name),this.images.push(e)},handleEditImage(e,o,i){-1!==e&&(this.images[e]={_id:o,blob:i})},async handleRemoveImage(e){this.images.splice(e,1),console.log("Image removed from array")},handleCanselResult(e){console.log("Canseled: "+e),this.isBooking=e}}},x=i(89);const S=(0,x.Z)(W,[["render",B],["__scopeId","data-v-10bf91de"]]);var R=S}}]);
//# sourceMappingURL=913.bff51ac8.js.map