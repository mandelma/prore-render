"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[580],{3998:function(e,t){const a=[{label:"Hitsaaja",value:"1"},{label:"Putkimies",value:"2"},{label:"Sähkömies",value:"3"}],l=[{label:"Siivooja",value:"4"}],i=[{group:"Rakennus",options:a},{group:"Kiinteistöala",options:l}];t.Z=i},8579:function(e,t,a){const l=a(7218),i="/api/upload",o=async()=>{const e=await l.get(i);return e.data},s=async e=>{const t=await l.post(i,e,{});return t.data},n=async(e,t)=>{const a=await l.post(`${i}/${e}/avatar`,t);return a.data},d=async(e,t)=>{const a=await l.post(`${i}/${e}/update_avatar`,t);return a.data},r=async(e,t)=>{const a=await l.put(`${i}/${e}`,t);return a.data},u=async(e,t)=>{await l.delete(`${i}/${e}/${t}`)};t.Z={getAll:o,create:s,createProfileImage:n,newAvatar:d,updateImage:r,remove:u}},8580:function(e,t,a){a.r(t),a.d(t,{default:function(){return U}});var l=a(3396),i=a(9242),o=a(7139);const s=(0,l._)("h2",{style:{"margin-top":"200px"}},"- Uusi tilaus -",-1),n={key:0,style:{"text-align":"left"}},d={class:"ui form"},r={class:"field"},u=(0,l._)("option",{value:""},"Valitse ammattilainen",-1),c=["label"],g=["value"],p=["value"],m=(0,l._)("option",{value:""},"Valitse ammattilainen",-1),h=["label"],k=["value"],w=["value"],f=["src"],v={key:1,for:"file-upload",class:"custom-file-upload"},y={key:0},b={key:1};function D(e,t,a,D,I,B){const C=(0,l.up)("MDBInput"),_=(0,l.up)("VueDatePicker"),M=(0,l.up)("MDBBtn"),x=(0,l.up)("MDBCol"),F=(0,l.up)("MDBTextarea"),H=(0,l.up)("MDBRow"),S=(0,l.up)("MDBContainer");return(0,l.wg)(),(0,l.iD)("div",null,[s,(0,l.Wm)(S,null,{default:(0,l.w5)((()=>[(0,l._)("form",{class:"g-3 needs-validation",novalidate:"",onSubmit:t[8]||(t[8]=(0,i.iM)(((...e)=>B.checkForm&&B.checkForm(...e)),["prevent"]))},[(0,l.Wm)(C,{label:"Anna otsikko",modelValue:I.header,"onUpdate:modelValue":t[0]||(t[0]=e=>I.header=e),id:"header",size:"lg",invalidFeedback:"Ole hyvä ja kirjoita otsikko.",validFeedback:"Ok!",required:"",wrapperClass:"mb-4"},null,8,["modelValue"]),a.recipientBookings.length>0?((0,l.wg)(),(0,l.iD)("p",n,"Osoite: "+(0,o.zw)(a.recipientBookings[0].address),1)):(0,l.kq)("",!0),(0,l.Wm)(C,{label:"Anna toinen osoitteesi",modelValue:I.address,"onUpdate:modelValue":t[1]||(t[1]=e=>I.address=e),id:"osoite",size:"lg",invalidFeedback:"Ole hyvä ja kirjoita osoite.",validFeedback:"Ok!",required:"",wrapperClass:"mb-4"},null,8,["modelValue"]),(0,l._)("div",d,[(0,l._)("div",r,[D.isNotSelected?(0,l.wy)(((0,l.wg)(),(0,l.iD)("select",{key:0,id:"noSelected",style:{"border-color":"red",color:"red","margin-bottom":"20px"},"onUpdate:modelValue":t[2]||(t[2]=e=>I.professional=e),onChange:t[3]||(t[3]=e=>D.isNotSelected=!1)},[u,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(I.prodata,(e=>((0,l.wg)(),(0,l.iD)(l.HY,null,[e.group?((0,l.wg)(),(0,l.iD)("optgroup",{label:e.group,key:e.group},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.options,(e=>((0,l.wg)(),(0,l.iD)("option",{value:e.label,key:e.label},(0,o.zw)(e.label),9,g)))),128))],8,c)):((0,l.wg)(),(0,l.iD)("option",{value:e,key:e.value},(0,o.zw)(e.label),9,p))],64)))),256))],544)),[[i.bM,I.professional]]):(0,l.wy)(((0,l.wg)(),(0,l.iD)("select",{key:1,"onUpdate:modelValue":t[4]||(t[4]=e=>I.professional=e),style:{"margin-bottom":"20px"}},[m,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(I.prodata,(e=>((0,l.wg)(),(0,l.iD)(l.HY,null,[e.group?((0,l.wg)(),(0,l.iD)("optgroup",{label:e.group,key:e.group},[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(e.options,(e=>((0,l.wg)(),(0,l.iD)("option",{value:e.label,key:e.label},(0,o.zw)(e.label),9,k)))),128))],8,h)):((0,l.wg)(),(0,l.iD)("option",{value:e,key:e.value},(0,o.zw)(e.label),9,w))],64)))),256))],512)),[[i.bM,I.professional]])])]),(0,l.Wm)(_,{style:{"margin-bottom":"20px"},modelValue:D.date,"onUpdate:modelValue":t[5]||(t[5]=e=>D.date=e),"min-date":new Date,placeholder:"Missä ajalla haluat ammattilaista?",onInternalModelChange:B.handleInternalDate,state:!I.isNoDate&&null},null,8,["modelValue","min-date","onInternalModelChange","state"]),(0,l.Wm)(S,{style:{"margin-bottom":"20px"}},{default:(0,l.w5)((()=>[(0,l.Wm)(H,null,{default:(0,l.w5)((()=>[(0,l.Wm)(x,{md:"4"},{default:(0,l.w5)((()=>[D.showImage?((0,l.wg)(),(0,l.iD)("img",{key:0,src:D.showImage,style:{width:"200px","margin-bottom":"20px"},alt:"..."},null,8,f)):(0,l.kq)("",!0),D.isUploaded?(0,l.kq)("",!0):((0,l.wg)(),(0,l.iD)("label",v,[I.value?((0,l.wg)(),(0,l.iD)("span",y," Muokkaa kuva: "+(0,o.zw)(I.value.name),1)):((0,l.wg)(),(0,l.iD)("span",b,"Valitse kuva tehtävästä"))])),(0,l._)("input",{id:"file-upload",type:"file",onChange:t[6]||(t[6]=(...e)=>B.handleFileChange&&B.handleFileChange(...e))},null,32),D.isImageSelected?((0,l.wg)(),(0,l.j4)(M,{key:2,outline:"danger",size:"lg",block:"",onClick:B.removeFile},{default:(0,l.w5)((()=>[(0,l.Uk)("Poista valitsettu kuva")])),_:1},8,["onClick"])):(0,l.kq)("",!0),D.isImageSelected?((0,l.wg)(),(0,l.j4)(M,{key:3,outline:"success",size:"lg",block:"",style:{"margin-bottom":"10px"},onClick:B.uploadImage},{default:(0,l.w5)((()=>[(0,l.Uk)("Lataa valitsettu kuva")])),_:1},8,["onClick"])):(0,l.kq)("",!0)])),_:1}),(0,l.Wm)(x,{md:"8"},{default:(0,l.w5)((()=>[(0,l.Wm)(F,{label:"Tehtävän kuvaus...",rows:"4",modelValue:D.explanation,"onUpdate:modelValue":t[7]||(t[7]=e=>D.explanation=e),invalidFeedback:"Ole hyvä ja kirjoita tehtävän kuvaus.",validFeedback:"Ok!",required:""},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),(0,l.Wm)(M,{outline:"success",size:"lg",block:"",onClick:B.addRecipient,style:{"margin-top":"20px","margin-bottom":"20px"},type:"submit"},{default:(0,l.w5)((()=>[(0,l.Uk)("Tee tilaus")])),_:1},8,["onClick"])],32),(0,l.Wm)(M,{outline:"danger",size:"lg",block:"",onClick:B.cancelRecipientForm,style:{"margin-bottom":"50px"}},{default:(0,l.w5)((()=>[(0,l.Uk)(" Poistu ")])),_:1},8,["onClick"])])),_:1})])}a(7658),a(2062);var I=a(4912),B=a(4313),C=a(5800),_=a(8579),M=a(3998),x=a(7514),F=a(4870),H={name:"recipient-form",props:{recipientBookings:Array},components:{MDBBtn:B.$v,MDBContainer:B.L5,MDBInput:B.u2,MDBRow:B.uZ,MDBCol:B.TK,MDBTextarea:B.uj,VueDatePicker:I.Z},data(){return{recipientId:null,header:"",address:null,lat:null,lng:null,isNoDate:!1,professional:"",addFile:null,dateTest:null,calendarTooltips:[],value:null,aaa:"",file:null,f:null,prodata:M.Z}},setup(){const e=(0,F.iH)(null),t=(0,F.iH)(""),a=(0,F.iH)(!1),l=(0,F.iH)(null),i=(0,F.iH)(null),o=(0,F.iH)(!1),s=(0,F.iH)(!1),n=(0,F.iH)(!1);return{date:e,explanation:t,isImageSelected:a,imgId:l,showImage:i,isShowImage:o,isUploaded:s,isNotSelected:n}},computed:{currentRouteName(){return this.$route.name}},async mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const t=JSON.parse(e);this.recipientId=t.id,console.log("User id in recipient: "+t.id)}const t={lat:50.064192,lng:-130.605469},a={north:t.lat+.1,south:t.lat-.1,east:t.lng+.1,west:t.lng-.1},l=document.getElementById("osoite"),i={bounds:a,componentRestrictions:{country:"fi"},fields:["address_components","geometry","icon","name","formatted_address"],strictBounds:!1},o=new google.maps.places.Autocomplete(l,i);o.addListener("place_changed",(()=>{let e=o.getPlace();this.lat=e.geometry.location.lat(),this.lng=e.geometry.location.lng(),this.address=e.formatted_address,console.log(e)}))},methods:{cancelRecipientForm(){"r-form"===this.currentRouteName?this.$router.push("/received"):this.$router.push("/")},async findRecipients(){const e=await C.Z.getOwnBookings(this.recipientId);console.log("Recipients "+e.length)},async remFile(){await _.Z.remove("644cff805261bf7d9943c5da","644cff875261bf7d9943c5dd")},handleFileChange(e){try{const t=e.target.files[0];console.log("event target client ",e.target.files[0]),t&&(this.showImage=URL.createObjectURL(t),this.file=e.target.files[0])}catch(t){console.log("Error:",t)}this.value=e.target.files[0],e.target.files[0]?this.isImageSelected=!0:this.isImageSelected=!1},async uploadImage(){const e=new FormData;e.append("file",this.file,this.file.name);const t=await _.Z.create(e);t&&(this.imgId=t.imgCreated._id,this.file=null,this.isImageSelected=!1,this.isUploaded=!0)},removeFile(){this.value=null,this.isImageSelected=!1,this.showImage=null},formatDate(e=Date){return e?(0,x.Z)(e,"dd.MM.yyyy, HH:mm"):null},backToDashboard(){},getDate(){console.log("selected date: "+this.date.getDate())},handleInternalDate(){console.log("Handled"),this.isNoDate=!1},async addRecipient(){let e;if(null===this.address&&(this.address=this.recipientBookings[0].address,this.lat=this.recipientBookings[0].latitude,this.lng=this.recipientBookings[0].longitude),""===this.professional&&(this.isNotSelected=!0),this.date||(this.isNoDate=!0),this.date&&(e={created:this.date,header:this.header,address:this.address,latitude:this.lat,longitude:this.lng,professional:this.professional,year:this.date.getFullYear(),month:this.date.getMonth(),day:this.date.getDate(),hours:this.date.getHours(),minutes:this.date.getMinutes(),description:this.explanation,imageId:this.imgId}),this.header&&this.address&&this.professional&&this.date&&this.explanation){const t=await C.Z.addRecipient(this.recipientId,e);this.$emit("booking:update",t),console.log("Booking--- "+t),this.$router.push("/received")}else console.log("Something went wrong"),console.log("Aadress "+this.address),console.log("header "+this.header),console.log("Explanation "+this.explanation),console.log("Profession "+this.professional),console.log("Date "+this.date)},checkForm(e=Event){e.target.classList.add("was-validated")}}},S=a(89);const V=(0,S.Z)(H,[["render",D]]);var U=V}}]);
//# sourceMappingURL=580.11452388.js.map