(function(){var e={5253:function(e,t){"use strict";const s=({num:e})=>{let t="";switch(5===e&&(t="Mis siis"),e){case 0:t="Tammikuu";break;case 1:t="Helmikuu";break;case 2:t="Maaliskuu";break;case 3:t="Huhtikuu";break;case 4:t="Toukokuu";break;case 5:t="Kesäkuu";break;case 6:t="Heinäkuu";break;case 7:t="Elokuu";break;case 8:t="Syyskuu";break;case 9:t="Lokakuu";break;case 10:t="Maaliskuu";break;case 11:t="Joulukuu";break}return t};t.Z=s},7718:function(e,t,s){"use strict";var n=s(9242),o=s(3396),i=s(7139);const r={class:"pill"};function a(e,t,s,n,a,l){const c=(0,o.up)("MDBNavbarBrand"),u=(0,o.up)("router-link"),d=(0,o.up)("MDBNavbarToggler"),g=(0,o.up)("MDBNavbarNav"),m=(0,o.up)("MDBCollapse"),p=(0,o.up)("MDBNavbarItem"),h=(0,o.up)("MDBIcon"),f=(0,o.up)("MDBBadge"),v=(0,o.up)("MDBDropdownToggle"),k=(0,o.up)("MDBDropdownItem"),b=(0,o.up)("MDBDropdownMenu"),w=(0,o.up)("MDBDropdown"),y=(0,o.up)("MDBNavbar"),D=(0,o.up)("Notifications"),U=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)(o.HY,null,[(0,o.Wm)(y,{size:"large",style:{position:"fixed","z-index":"1"},position:"top",container:"",expand:"xl",bg:"light",class:"d-flex justify-content-between"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{to:"/"},{default:(0,o.w5)((()=>[(0,o.Wm)(c,null,{default:(0,o.w5)((()=>[(0,o.Uk)(" Pro Connections ")])),_:1})])),_:1}),(0,o.Wm)(d,{right:"",target:"#navbarColor01",onClick:t[0]||(t[0]=e=>n.collapse7=!n.collapse7)}),(0,o.Wm)(m,{id:"navbarColor01",modelValue:n.collapse7,"onUpdate:modelValue":t[1]||(t[1]=e=>n.collapse7=e)},{default:(0,o.w5)((()=>[(0,o.Wm)(g,{center:"",class:"mb-2 mb-lg-0"})])),_:1},8,["modelValue"]),void 0===a.loggedUser.token?((0,o.wg)(),(0,o.j4)(g,{key:0,right:"",class:"mb-2 mb-lg-0 d-flex flex-row"},{default:(0,o.w5)((()=>[(0,o.Wm)(p,null,{default:(0,o.w5)((()=>[(0,o.Wm)(u,{to:"/login",onClick:t[2]||(t[2]=e=>n.collapse7=!1)},{default:(0,o.w5)((()=>[(0,o.Uk)("Kirjaudu")])),_:1})])),_:1})])),_:1})):((0,o.wg)(),(0,o.j4)(g,{key:1,right:"",class:"mb-2 mb-lg-0 d-flex flex-row"},{default:(0,o.w5)((()=>[a.messageInfo.length>0?((0,o.wg)(),(0,o.j4)(p,{key:0,to:"/chat",style:{padding:"10px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{icon:"comments",size:"2x"}),(0,o.Wm)(f,{pill:"",notification:"",badge:"danger"},{default:(0,o.w5)((()=>[(0,o.Uk)("1")])),_:1})])),_:1})):(0,o.kq)("",!0),a.providerBookings.length>0?((0,o.wg)(),(0,o.j4)(p,{key:1,to:"/notification",class:"me-3 me-lg-0",linkClass:"link-secondary",style:{padding:"10px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{icon:"bell",size:"2x",disabled:!0,onClick:l.handleNotifications},null,8,["onClick"]),a.notSeenClientBookings.length>0?((0,o.wg)(),(0,o.j4)(f,{key:0,notification:"",color:"danger",class:"translate-middle p-1",onClick:l.handleNotifications,pill:""},{default:(0,o.w5)((()=>[(0,o._)("span",r,(0,i.zw)(a.notSeenClientBookings.length),1)])),_:1},8,["onClick"])):((0,o.wg)(),(0,o.j4)(f,{key:1,notification:"",color:"danger",class:"translate-middle p-2",pill:""}))])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(w,{modelValue:n.dropdownUser,"onUpdate:modelValue":t[4]||(t[4]=e=>n.dropdownUser=e),style:{padding:"10px"}},{default:(0,o.w5)((()=>[(0,o.Wm)(v,{tag:"a",class:"nav-link",onClick:t[3]||(t[3]=e=>n.dropdownUser=!n.dropdownUser)},{default:(0,o.w5)((()=>[(0,o.Wm)(h,{icon:"user",size:"2x"})])),_:1}),(0,o.Wm)(b,null,{default:(0,o.w5)((()=>[(0,o.Wm)(k,{href:"#"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{to:"/profile"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Omat tiedot ")])),_:1})])),_:1}),a.recipientBookings.length>0?((0,o.wg)(),(0,o.j4)(k,{key:0,href:"#"},{default:(0,o.w5)((()=>[(0,o.Wm)(u,{to:"/history"},{default:(0,o.w5)((()=>[(0,o.Uk)(" Historia ")])),_:1})])),_:1})):(0,o.kq)("",!0),(0,o.Wm)(k,{href:"#",onClick:l.handleLogOut},{default:(0,o.w5)((()=>[(0,o.Uk)(" Log out ")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["modelValue"])])),_:1}))])),_:1}),a.isNotification?((0,o.wg)(),(0,o.j4)(D,{key:0,"onExit:notifications":l.handleExitNotifications,"onUpdate:status":l.handleStatusUpdate,bookings:a.providerBookings},null,8,["onExit:notifications","onUpdate:status","bookings"])):(0,o.kq)("",!0),(0,o.Wm)(U,{"onLogin:data":l.handleLogin,"onRegister:data":l.createUser,userIsProvider:a.userIsProvider,loggedInUser:a.loggedUser,recipientBookings:a.recipientBookings,"onBooking:update":l.handleRecipientBookingsUpdate,"onExit:notifications":l.handleExitNotifications,"onUpdate:status":l.handleStatusUpdate,"onRemove:booking":l.handleRemoveBooking,"onActivate:bell":l.handleActivateBell,"onDeactivate:bell":l.handleDeActivateBell,bookings:a.providerBookings,bookingsConfirmed:a.providerBookingsHistory,recipientConfirmedBookings:a.recipientConfirmedBookings,"onTo:app":l.fromFinal,onFinalinfo:l.fromFinal,onChatCredentials:l.handleChat,chatusers:a.users,activeUser:a.activeUser,messages:a.conversation,"onSelect:user":l.onSelectUser,"onOn:message":l.handleMessage,onOtherUser:l.otherUser},null,8,["onLogin:data","onRegister:data","userIsProvider","loggedInUser","recipientBookings","onBooking:update","onExit:notifications","onUpdate:status","onRemove:booking","onActivate:bell","onDeactivate:bell","bookings","bookingsConfirmed","recipientConfirmedBookings","onTo:app","onFinalinfo","onChatCredentials","chatusers","activeUser","messages","onSelect:user","onOn:message","onOtherUser"])],64)}s(7658);var l=s(3797),c=s(1478),u=s(9398),d=s(5800),g=s(6823);const m=async()=>{const e=window.localStorage.getItem("loggedAppUser");if(e){console.log("Tooooken 0 "+e);const t=JSON.parse(e).token,s=await g.Z.verifyToken(t);return!s}};var p={validation:m},h=s(7137),f=s(7245),v=s(4313),k=s(4870),b=s(4058);const w=e=>{e.hasNewMessages=!1,e.messages=[]};var y={name:"App",props:{},components:{User:h.Z,MessagePanel:f.Z,Notifications:l["default"],MDBNavbar:v.A0,MDBCollapse:v.Eq,MDBNavbarItem:v.V$,MDBNavbarBrand:v.JI,MDBNavbarNav:v.T2,MDBNavbarToggler:v.$Y,MDBBadge:v.m_,MDBIcon:v.vm,MDBDropdown:v.H6,MDBDropdownToggle:v.CU,MDBDropdownMenu:v.Ed,MDBDropdownItem:v.i2},data(){return{user:null,isNewMessage:!0,messageInfo:"",tu:[],roomroom:"",userSocketID:"",info:"",users:[],currentRoom:"",messages:[],conversation:[],selectedUser:null,activeUser:null,msg:"",isBell:!1,loggedUser:{},recipientBookings:[],userIsProvider:{},providerBookings:[],providerBookingsHistory:[],recipientConfirmedBookings:[],isNotification:!1,notSeenClientBookings:[],newMessage:"",otheruser:{}}},created(){},async mounted(){this.validateToken();const e=window.localStorage.getItem("loggedAppUser");if(e){const t=JSON.parse(e);this.user=t;const s=t.username,n=t.id;this.currentRoom=t.username+t.id,this.joinServer(s,n)}},setup(){const e=(0,k.iH)(!1),t=(0,k.iH)(!1),s=(0,k.iH)(!1);return{collapse7:e,dropdownUser:t,dropdownBell:s}},methods:{startChat(){b.Z.emit("join all rooms")},chat(){console.log("Clicked to chat")},handleChat(e){console.log("Chat data: "+e.room+" "+e.userID+" "+e.username),this.roomroom=e.room,this.currentRoom=e.room,console.log("Tuba "+this.roomroom),b.Z.emit("update room",e.room)},fromFinal(e){this.info=e,console.log("Data from final in app: "+e)},submit(e,t,s){console.log("What===");let n={userID:e,username:t,room:s};b.Z.emit("new chat user",n)},joinServer:function(e,t){console.log("Joining server: "+e+" ja id: "+t),b.Z.on("get socketID",(e=>{console.log("user socket id "+e),this.userSocketID=e})),b.Z.on("get current credentials",(()=>{b.Z.emit("current credentials",{room:this.currentRoom,userID:t,username:e})})),b.Z.on("loggedIn",(e=>{this.users=[],console.log("xxxxxxxxxxxxxxxxxxxxxxxxxxx"),e.users.forEach((e=>{for(let t=0;t<this.users.length;t++){const s=this.users[t];if(s.userID===e.userID)return void(s.connected=e.connected)}e.self=e.userID===this.loggedUser.id,e.self||(this.activeUser=e),w(e),e.messages=[],this.users.push(e)})),this.users.sort(((e,t)=>e.self?-1:t.self?1:e.username<t.username?-1:e.username>t.username?1:0)),console.log("Room users: "+e.users.map((e=>e.username)))})),this.listen()},listen:function(){b.Z.on("user info",(e=>{})),b.Z.on("userOnline",(e=>{this.users=[],b.Z.on("get socketID",(e=>{console.log("user socket id "+e),this.userSocketId=e})),e.users.forEach((e=>{for(let t=0;t<this.users.length;t++){const s=this.users[t];if(s.userID===e.userID)return void(s.connected=e.connected)}e.self=e.userID===this.loggedUser.id,e.self||(this.activeUser=e),this.initReactiveProperties(e),e.messages=[],this.users.push(e)})),this.users.sort(((e,t)=>e.self?-1:t.self?1:e.username<t.username?-1:e.username>t.username?1:0))})),b.Z.on("userLeft",((e,t,s)=>{console.log("User left "+e,t,s);for(let n=0;n<this.users.length;n++){const t=this.users[n];if(t.userID===e){t.connected=!1;break}}})),b.Z.on("connect",(()=>{this.users.forEach((e=>{e.self||(e.connected=!0)}))})),b.Z.on("disconnect",(()=>{this.users.forEach((e=>{e.self&&(e.connected=!1)}))})),b.Z.on("msg",(e=>{console.log("Selected user here "+this.selectedUser)})),b.Z.on("new message",(()=>{console.log("Uus sõnum!!!"),this.isNewMessage?this.messageInfo="Said uue sõnumi":this.messageInfo=""})),b.Z.emit("online",this.currentRoom),b.Z.on("messages",(e=>{this.conversation=e.msg})),b.Z.on("private message",(({content:e,date:t,from:s,to:n})=>{b.Z.on("messages",(e=>{this.conversation=e.msg}));for(let o=0;o<this.users.length;o++){const i=this.users[o],r=this.userSocketId===s;if(i.userID===(r?n:s)){this.conversation.push({content:e,date:t,fromSelf:r}),i.messages.push({content:e,date:t,fromSelf:r}),i!==this.selectedUser&&(i.hasNewMessages=!0,this.messageSeen=!0,console.log("Users length "+this.users.length));break}}}))},initReactiveProperties(e){e.hasNewMessages=!1,e.messages=[]},onSelectUser(e){e.self||(this.selectedUser=e),console.log("----------Tuleb läbi--------"),this.isNewMessage=!1,e.hasNewMessages=!1,this.isNewMessage=!1,this.messageInfo=""},sendMessage:function(){let e=this.msg;b.Z.emit("private message",{content:e,to:this.selectedUser.userID})},otherUser(e){this.otheruser=e,console.log("otherusernn "+e.username)},handleMessage(e,t){this.conversation.push({content:e,date:t,user:this.loggedUser.username}),b.Z.emit("private message",{content:e,date:t,to:this.selectedUser.userID})},updateRoom(){},handleActivateBell(e){console.log("Bell bell bell "+e)},handleDeActivateBell(){},profile(){this.$router.push("/profile"),console.log("Pressed profile")},history(){this.$router.push("/history")},renderPage(){this.$router.push({path:"/chat"}).then((()=>{this.$router.go()}))},renderDialogPage(){this.$router.push({path:"/dialog"}).then((()=>{this.$router.go()}))},reload:()=>{(void 0).isRouterAlive=!1,setTimeout((()=>{(void 0).isRouterAlive=!0}),0)},async getUsers(){this.users=await c.Z.getAll()},async createUser(e){console.log("User name is here: "+e.username),this.submit(e.id,e.username,e.username+e.id),window.localStorage.setItem("loggedAppUser",JSON.stringify(e)),this.loggedUser=e,window.location.replace("/")},async handleLogin(e){console.log("userdata: "+e.username),window.localStorage.setItem("loggedAppUser",JSON.stringify(e)),this.loggedUser=e,this.validateToken();let t=e.username,s=e.id,n=t+s;this.submit(s,t,n),this.$route.query.redirect?this.$router.push(this.$route.query.redirect):window.location.replace("/")},handleLogOut(){window.localStorage.removeItem("loggedAppUser"),this.loginUser="",this.loggedUser="",this.$router.push("/")},async handleProvider(){this.userIsProvider=await u.Z.getProvider(this.loggedUser.id),this.userIsProvider&&(this.providerBookings=this.userIsProvider.booking.filter((e=>"confirmed"!==e.status&&"waiting"!==e.status)),this.providerBookingsHistory=this.userIsProvider.booking.filter((e=>"confirmed"===e.status))),this.notSeenClientBookings=this.providerBookings.filter((e=>"notSeen"===e.status)),this.providerBookings.forEach((e=>{e.status})),console.log("xxxxxxxxxxx len "+this.notSeenClientBookings.length)},async handleRecipientBookings(){this.recipientBookings=await d.Z.getOwnBookings(this.loggedUser.id),this.recipientConfirmedBookings=this.recipientBookings.filter((e=>"confirmed"===e.status))},handleRecipientBookingsUpdate(e){this.recipientBookings=this.recipientBookings.concat(e)},handleNotifications(){this.$router.push("/notification")},handleExitNotifications(e){console.log("State is: "+e),this.isNotification=e},handleStatusUpdate(e){this.notSeenClientBookings=this.notSeenClientBookings.filter((t=>t.id!==e?t:null)),this.handleProvider()},handleRemoveBooking(e){console.log("Handling remove booking..."+e),this.providerBookings=this.providerBookings.filter((t=>t.id!==e))},test(){console.log("xxxx "+p)},async validateToken(){const e=window.localStorage.getItem("loggedAppUser");if(e){const t=JSON.parse(e),s=await g.Z.verifyToken(t.token);"token expired"===s.result?(window.localStorage.removeItem("loggedAppUser"),this.loggedUser=""):(this.loggedUser=t,console.log("Loged, logged user "+this.loggedUser.username),this.handleRecipientBookings(),this.handleProvider())}},runEveryMinite(){alert("The minute has passed!!")}},unmounted(){},computed:{isValid(){return this.msg.length>0}}},D=s(89);const U=(0,D.Z)(y,[["render",a]]);var B=U,I=s(2483);const C=[{path:"/",name:"dash-board",component:()=>s.e(244).then(s.bind(s,3244))},{path:"/register",name:"app-register",component:()=>s.e(394).then(s.bind(s,394))},{path:"/login",name:"login-register",component:()=>s.e(434).then(s.bind(s,7434))},{path:"/profile",name:"user-profile",component:()=>s.e(382).then(s.bind(s,8382))},{path:"/recipient-public",name:"recipient-public",component:()=>Promise.all([s.e(161),s.e(86)]).then(s.bind(s,6086))},{path:"/recipient-form",name:"recipient-form",component:()=>s.e(360).then(s.bind(s,6360)),beforeEnter:async(e,t,s)=>{const n=window.localStorage.getItem("loggedAppUser"),o=JSON.parse(n),i=await d.Z.getOwnBookings(o.id);if(i.length>0)return s("/received");s()},meta:{requiresAuth:!0}},{path:"/received",name:"recipient-panel",component:()=>Promise.all([s.e(227),s.e(383)]).then(s.bind(s,9245))},{path:"/recipient-result",name:"recipient-result",component:()=>Promise.all([s.e(227),s.e(365)]).then(s.bind(s,7227))},{path:"/received-final/:data",name:"recipient-final",component:()=>s.e(185).then(s.bind(s,9185)),props:!0},{path:"/rf",name:"r-form",component:()=>s.e(360).then(s.bind(s,6360))},{path:"/provider-public",name:"provider-public",component:()=>Promise.all([s.e(161),s.e(515)]).then(s.bind(s,4515)),beforeEnter:async(e,t,s)=>{const n=window.localStorage.getItem("loggedAppUser");if(!n)return s();{const e=JSON.parse(n),t=await u.Z.getProvider(e.id);if(t)return s("/provider-panel");s()}}},{path:"/provider-form",name:"provider-form",component:()=>Promise.all([s.e(161),s.e(437)]).then(s.bind(s,8437)),beforeEnter:async(e,t,s)=>{const n=window.localStorage.getItem("loggedAppUser"),o=JSON.parse(n),i=await u.Z.getProvider(o.id);if(i)return s("/provider-panel");s()}},{path:"/provider-panel",name:"provider-panel",component:()=>s.e(300).then(s.bind(s,8300)),props:!0},{path:"/location",name:"user-location",component:()=>Promise.all([s.e(161),s.e(320)]).then(s.bind(s,6320))},{path:"/notification",name:"client-notifications",component:()=>Promise.resolve().then(s.bind(s,3797))},{path:"/chat",name:"chat-panel",component:()=>s.e(113).then(s.bind(s,5113))},{path:"/chat",name:"live-chat",component:()=>s.e(113).then(s.bind(s,5113))},{path:"/history",name:"user-history",component:()=>s.e(901).then(s.bind(s,1901))}],M=["recipient-form","provider-form"],S=(0,I.p7)({history:(0,I.r5)(),routes:C});S.beforeEach((async(e,t,s)=>{const n=window.localStorage.getItem("loggedAppUser");if(n){JSON.parse(n)}const o=M.includes(e.name);o&&!n?s({path:"/login",query:{redirect:e.fullPath}}):s()}));var _=S,x=s(4912),Z=s(3852);(0,n.ri)(B).component("VueDatePicker",x.Z),(0,n.ri)(B).use(_).use(Z.ZP).mount("#app")},6823:function(e,t,s){"use strict";const n=s(7218),o="/api/login",i=async e=>{const t=await n.post(o,e);return t.data},r=async e=>{const t=await n.post(`${o}/${e}`);return t.data};t.Z={login:i,verifyToken:r}},9398:function(e,t,s){"use strict";const n=s(7218),o="/api/providers",i=async()=>{const e=await n.get(o);return e.data},r=async e=>{const t=await n.get(`${o}/${e}`);return t.data},a=async e=>{const t=await n.post(`${o}/profession`,e);return t.data},l=async(e,t)=>{const s=await n.post(`${o}/${e}`,t);return s.data},c=async(e,t)=>{const s=await n.post(`${o}/${e}/addRoom`,t);return s.data},u=async(e,t)=>{const s=await n.post(`${o}/${e}/addRecipient/${t}`);return s.data},d=async(e,t)=>{const s=await n.put(`${o}/${e}`,t);return s.data},g=async(e,t)=>{const s=await n.delete(`${o}/${e}/recipient/${t}`);return s.data};t.Z={getProviders:i,getProvider:r,getProvidersMatchingByProfession:a,addProvider:l,updateProvider:d,addRoom:c,addProviderBooking:u,removeProviderBooking:g}},5800:function(e,t,s){"use strict";const n=s(7218),o="/api/recipients",i=async()=>{const e=await n.get(o);return e.data},r=async e=>{const t=await n.get(`${o}/user/${e}`);return t.data},a=async e=>{const t=await n.get(`${o}/booking/${e}`);return t.data},l=async(e,t)=>{const s=await n.post(`${o}/${e}`,t);return s.data},c=async(e,t)=>{const s=await n.put(`${o}/${e}`,t);return s.data};t.Z={getRecipients:i,getOwnBookings:r,getBookingById:a,addRecipient:l,updateRecipient:c}},1478:function(e,t,s){"use strict";const n=s(7218),o="/api/users",i=async()=>{const e=await n.get(o);return e.data},r=async e=>{const t=await n.post(`${o}`,e);return t.data};t.Z={getAll:i,addUser:r}},4058:function(e,t,s){"use strict";var n=s(2066);const o="https://line-app-pro.onrender.com/",i={"force new connection":!0,reconnectionAttempts:"Infinity",timeout:1e4,transports:["websocket"]},r=n.io.connect(o,i);r.onAny(((e,...t)=>{console.log(e,t)})),t.Z=r},7245:function(e,t,s){"use strict";s.d(t,{Z:function(){return k}});var n=s(3396),o=s(7139),i=s(9242);const r={class:"panel"},a={class:"messages",ref:"messagesRef"},l={class:"inner"},c={class:"sender"},u={class:"text"},d={class:"date"},g=["disabled"];function m(e,t,s,m,p,h){return(0,n.wg)(),(0,n.iD)("div",r,[(0,n._)("div",a,[(0,n._)("div",l,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.messages,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e._id},[(0,n._)("div",c,(0,o.zw)(e.username),1),(0,n._)("div",u,(0,o.zw)(e.content),1),(0,n._)("div",d,(0,o.zw)(e.date),1)])))),128))])],512),(0,n._)("form",{onSubmit:t[1]||(t[1]=(0,i.iM)(((...e)=>h.onSubmit&&h.onSubmit(...e)),["prevent"]))},[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.msg=e),placeholder:"Kirjoita viesti..."},null,512),[[i.nr,p.msg]]),(0,n._)("button",{disabled:!h.isValid},"+",8,g)],32)])}var p=s(4045),h={name:"MessagePanel",components:{},props:{user:Object,messages:Array,initMessages:Array},data(){return{msg:""}},methods:{onSubmit(){const e=new Date;this.$emit("new:message",this.msg,(0,p.ZP)(e,"dd-mm-yyyy,  HH:MM")),this.msg=""},displaySender(e,t){return 0===t||this.user.messages[t-1].fromSelf!==this.user.messages[t].fromSelf}},computed:{isValid(){return this.msg.length>0}}},f=s(89);const v=(0,f.Z)(h,[["render",m],["__scopeId","data-v-52d9d388"]]);var k=v},7137:function(e,t,s){"use strict";s.d(t,{Z:function(){return w}});var n=s(3396),o=s(7139);const i={class:"description"},r={key:0,class:"name"},a={key:0,class:"new-messages"},l={key:1,class:"status"};function c(e,t,s,c,u,d){const g=(0,n.up)("status-icon");return(0,n.wg)(),(0,n.iD)("div",{class:(0,o.C_)(["user",{selected:s.selected}]),onClick:t[0]||(t[0]=(...e)=>d.onClick&&d.onClick(...e))},[(0,n._)("div",i,[s.user.self?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",r,[s.user.hasNewMessages?((0,n.wg)(),(0,n.iD)("div",a,"!")):(0,n.kq)("",!0),(0,n.Uk)((0,o.zw)(d.status),1)])),s.user.self?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("div",l,[(0,n.Wm)(g,{user:s.user,connected:s.user.connected},null,8,["user","connected"])]))])],2)}const u=e=>((0,n.dD)("data-v-79bd9098"),e=e(),(0,n.Cn)(),e),d=u((()=>(0,n._)("div",null,null,-1))),g={style:{}};function m(e,t,s,i,r,a){return(0,n.wg)(),(0,n.iD)(n.HY,null,[d,(0,n._)("p",g,[(0,n.Uk)((0,o.zw)(s.user.username)+" ",1),(0,n._)("i",{class:(0,o.C_)(["icon",{connected:s.connected}]),style:{padding:"10px","margin-left":"10px"}},null,2)])],64)}var p={name:"StatusIcon",components:{},props:{connected:Boolean,user:Object}},h=s(89);const f=(0,h.Z)(p,[["render",m],["__scopeId","data-v-79bd9098"]]);var v=f,k={name:"chat-user",components:{StatusIcon:v},props:{user:Object,firstUser:String,selected:Boolean},methods:{onClick(){console.log("Clicked in user"),this.$emit("select")}},computed:{status(){return this.user.connected?"Aloita chattailu":"käyttäjä offline-tilassa Jätä viesti"}}};const b=(0,h.Z)(k,[["render",c],["__scopeId","data-v-298e33a7"]]);var w=b},3797:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var n=s(3396),o=s(7139),i=s(9242);const r=e=>((0,n.dD)("data-v-ae86f6d2"),e=e(),(0,n.Cn)(),e),a={key:0,class:"spinner-border",role:"status"},l=r((()=>(0,n._)("span",{class:"visually-hidden"},"Loading...",-1))),c=[l],u={key:1},d=["onClick"],g=["onClick"],m={style:{border:"solid blue"}},p={key:0},h=["src"],f=r((()=>(0,n._)("tr",null,[(0,n._)("td")],-1))),v=r((()=>(0,n._)("tr",null,[(0,n._)("td")],-1)));function k(e,t,s,r,l,k){const b=(0,n.up)("monthConverter"),w=(0,n.up)("MDBTabItem"),y=(0,n.up)("MDBTabNav"),D=(0,n.up)("MDBBtnClose"),U=(0,n.up)("MDBBtn"),B=(0,n.up)("User"),I=(0,n.up)("MessagePanel"),C=(0,n.up)("MDBTable"),M=(0,n.up)("MDBTabPane"),S=(0,n.up)("MDBTabContent"),_=(0,n.up)("MDBTabs"),x=(0,n.up)("MDBContainer");return(0,n.wg)(),(0,n.iD)("div",null,[(0,n.Wm)(x,{style:{"margin-top":"200px"}},{default:(0,n.w5)((()=>[0===l.bookings.length?((0,n.wg)(),(0,n.iD)("div",a,c)):((0,n.wg)(),(0,n.iD)("div",u,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(l.bookings,((r,a)=>((0,n.wg)(),(0,n.j4)(_,{modelValue:e.activeTab,"onUpdate:modelValue":t[2]||(t[2]=t=>e.activeTab=t),vertical:"lg",key:a},{default:(0,n.w5)((()=>["confirmed"!==r.state?((0,n.wg)(),(0,n.j4)(y,{key:0,pills:"",tabsClasses:"mb-3 text-center"},{default:(0,n.w5)((()=>[(0,n.Wm)(w,{wrap:!1,tabId:"{{booking.id}}",href:"{{booking.id}}"},{default:(0,n.w5)((()=>["notSeen"===r.status?((0,n.wg)(),(0,n.iD)("b",{key:0,onClick:e=>k.messageSeen(r)},[(0,n.Wm)(b,{num:r.onTime[0].month},null,8,["num"]),(0,n.Uk)(" "+(0,o.zw)(r.onTime[0].day)+" "+(0,o.zw)(r.onTime[0].year)+" - "+(0,o.zw)(r.header),1)],8,d)):((0,n.wg)(),(0,n.iD)("p",{key:1,onClick:e=>k.messageSeen(r)},[(0,n.Wm)(b,{num:r.onTime[0].month},null,8,["num"]),(0,n.Uk)(" "+(0,o.zw)(r.onTime[0].day)+" "+(0,o.zw)(r.onTime[0].year)+" - "+(0,o.zw)(r.header),1)],8,g))])),_:2},1024)])),_:2},1024)):(0,n.kq)("",!0),(0,n.Wm)(S,null,{default:(0,n.w5)((()=>[(0,n.Wm)(M,{tabId:"{{booking.id}}",href:"{{booking.id}}",class:"dataContainer"},{default:(0,n.w5)((()=>[(0,n.Wm)(C,{borderless:"",style:{"font-size":"18px","text-align":"center"}},{default:(0,n.w5)((()=>[(0,n._)("tbody",null,[(0,n._)("tr",null,[(0,n._)("td",null,[(0,n.Uk)((0,o.zw)(r.address)+" ",1),(0,n.Wm)(D,{class:"closeData",onClick:k.exitFromNotificationData},null,8,["onClick"])])]),(0,n._)("tr",null,[(0,n._)("td",m,(0,o.zw)(r.description),1)]),(0,n._)("tr",null,[r.image?((0,n.wg)(),(0,n.iD)("td",p,[l.isImageOpen?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(U,{key:0,outline:"success",onClick:e=>k.openImagePanel(r.image)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Open image ")])),_:2},1032,["onClick"])),(0,n._)("div",null,[l.isOpenImage?((0,n.wg)(),(0,n.iD)("img",{key:0,id:"img",class:"loading",src:l.srcImg,alt:"kuva"},null,8,h)):(0,n.kq)("",!0),l.isImageOpen?((0,n.wg)(),(0,n.j4)(U,{key:1,outline:"secondary",onClick:k.closeImagePanel},{default:(0,n.w5)((()=>[(0,n.Uk)(" Close image ")])),_:1},8,["onClick"])):(0,n.kq)("",!0)])])):(0,n.kq)("",!0)]),f,v,(0,n._)("tr",null,[(0,n._)("td",null,[(0,n._)("form",{onSubmit:t[0]||(t[0]=(0,i.iM)(((...t)=>e.contactToUser&&e.contactToUser(...t)),["prevent"]))},null,32),(0,n._)("form",{onSubmit:t[1]||(t[1]=(0,i.iM)(((...t)=>e.contactToUser&&e.contactToUser(...t)),["prevent"]))},[l.isPressedOpenChat&&!l.isPressedFinal?((0,n.wg)(),(0,n.j4)(U,{key:0,type:"submit",size:"lg",color:"success"},{default:(0,n.w5)((()=>[(0,n.Uk)(" Saada kasutajale sõnum ")])),_:1})):(0,n.kq)("",!0)],32)])]),(0,n._)("tr",null,[(0,n._)("td",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(s.chatusers,(e=>((0,n.wg)(),(0,n.iD)("div",{key:e.userID},[(0,n.Wm)(B,{user:e,selected:l.selectedUser===e,onSelect:t=>k.selectUser(e)},null,8,["user","selected","onSelect"])])))),128)),l.selectedUser?((0,n.wg)(),(0,n.j4)(I,{key:0,user:l.selectedUser,messages:s.messages,"onNew:message":k.onMessage},null,8,["user","messages","onNew:message"])):(0,n.kq)("",!0)])])])])),_:2},1024),(0,n.Wm)(U,{block:"",outline:"success",onClick:e=>k.confirmBooking(r.id)},{default:(0,n.w5)((()=>[(0,n.Uk)(" Kinnita tellimus ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["modelValue"])))),128))]))])),_:1})])}s(7658);var b=s(4313),w=s(4870),y=s(2043),D=s(5253),U=s(5800),B=s(9398),I=s(7137),C=s(7245);function M(e,t,s,o,i,r){const a=(0,n.up)("user"),l=(0,n.up)("message-panel");return(0,n.wg)(),(0,n.iD)("div",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(i.users,(t=>((0,n.wg)(),(0,n.iD)("div",{key:t.id,style:{width:"300px",margin:"auto","margin-bottom":"5px","border-radius":"5px"}},[(0,n._)("p",null,[t.self?(0,n.kq)("",!0):((0,n.wg)(),(0,n.j4)(a,{key:0,user:t,firstUser:e.userFirst,selected:i.selectedUser===t,onSelect:e=>r.onSelectUser(t)},null,8,["user","firstUser","selected","onSelect"]))])])))),128)),i.selectedUser?((0,n.wg)(),(0,n.j4)(l,{key:0,user:i.selectedUser,initMessages:i.initMessages,"onNew:message":r.onMessage},null,8,["user","initMessages","onNew:message"])):(0,n.kq)("",!0)])}var S=s(4058),_={name:"chat-io",props:{me:Object,uname:String,rm:String,isUserRemoved:Boolean},components:{User:I.Z,MessagePanel:C.Z},data(){return{selectedUser:null,users:[],room:"",firstUser:"",user:!0,initMessages:{}}},methods:{onMessage(e,t){this.selectedUser&&(console.log("Selected user: "+this.selectedUser.username),S.Z.emit("private message",{content:e,date:t,to:this.selectedUser.userID}),this.selectedUser.messages.push({content:e,date:t,fromSelf:!0}))},onSelectUser(e){e.self||(this.selectedUser=e),e.hasNewMessages=!1}},mounted(){S.Z.on("init messages",(e=>{this.initMessages=e.messages}))},beforeMount(){},created(){S.Z.on("init messages",(e=>{this.initMessages=e.messages})),S.Z.on("connect",(()=>{this.users.forEach((e=>{e.self&&(e.connected=!0)}))})),S.Z.on("disconnect",(()=>{this.users.forEach((e=>{e.self&&(e.connected=!1)}))}));const e=e=>{this.initMessages.length>0&&(console.log("Room vvvvvv"+this.initMessages[0].room),this.room=this.initMessages[0].room),e.room===this.room?e.messages=this.initMessages:e.messages=[],e.hasNewMessages=!1};S.Z.on("get room users",(t=>{console.log("Room users: "+t.users.map((e=>e.username))),t.users.forEach((t=>{for(let e=0;e<this.users.length;e++){const s=this.users[e];if(s.userID===t.userID)return void(s.connected=t.connected)}t.self=t.userID===S.Z.userID,e(t),this.users.push(t)})),this.users.sort(((e,t)=>e.self?-1:t.self?1:e.username<t.username?-1:e.username>t.username?1:0))})),S.Z.on("get updated room users",(t=>{this.users=[],t.users.forEach((t=>{for(let e=0;e<this.users.length;e++){const s=this.users[e];if(s.userID===t.userID)return void(s.connected=t.connected)}t.self=t.userID===S.Z.userID,t.self||(this.selectedUser=t),e(t),this.users.push(t)})),this.users.sort(((e,t)=>e.self?-1:t.self?1:e.username<t.username?-1:e.username>t.username?1:0))})),S.Z.on("user connected",(t=>{for(let e=0;e<this.users.length;e++){const s=this.users[e];if(s.userID===t.userID)return void(s.connected=!0)}e(t),this.users.push(t)})),S.Z.on("user disconnected",(e=>{for(let t=0;t<this.users.length;t++){const s=this.users[t];if(s.userID===e){s.connected=!1;break}}})),S.Z.on("private message",(({content:e,date:t,from:s,to:n})=>{for(let o=0;o<this.users.length;o++){const i=this.users[o],r=S.Z.userID===s;if(i.userID===(r?n:s)){i.messages.push({content:e,date:t,fromSelf:r}),i!==this.selectedUser&&(i.hasNewMessages=!0);break}}}))},unmounted(){S.Z.off("connect"),S.Z.off("disconnect"),S.Z.off("users"),S.Z.off("user connected"),S.Z.off("user disconnected"),S.Z.off("private message")}},x=s(89);const Z=(0,x.Z)(_,[["render",M],["__scopeId","data-v-4a92ac8e"]]);var P=Z,N=s(376),T=s(6849),O={name:"client-notifications",props:{bookings:Array,chatusers:Array,activeUser:null,messages:Array,loggedInUser:Object,userIsProvider:Object,room:String},components:{User:I.Z,MessagePanel:C.Z,PulseLoader:y.Z,monthConverter:D.Z,TabView:N.Z,TabPanel:T.Z,chatContent:P,MDBContainer:b.L5,MDBRow:b.uZ,MDBCol:b.TK,MDBListGroup:b.d8,MDBListGroupItem:b.FQ,MDBTabs:b.zk,MDBTabNav:b.JH,MDBTabItem:b.kX,MDBTabContent:b.oJ,MDBTabPane:b._I,MDBTable:b.re,MDBBtnClose:b.Ok,MDBBtn:b.$v},setup(){const e=(0,w.iH)("null"),t=(0,w.iH)(Array.from({length:2},((e,t)=>({title:`Tab ${t+1}`,content:`Tab ${t+1} Content`}))));return{activeTabId4:e,scrollableTabs:t}},data(){return{selectedUser:null,userIn:null,bookings:[],currentRoom:"",bookingDate:null,isSeen:!1,isOpenImage:!1,isImageOpen:!1,srcImg:"",isChatOpen:!1,isRenderData:!1,loading:!1,id:null,un:"sanna",ri:"",room:"",isChat:!1,isPressedOpenChat:!1,isPressedContactToUser:!1,isConnection:!1,isPressedFinal:!1,count:0}},mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const t=JSON.parse(e);this.userIn=t,this.handleBookings()}else this.$router.push("/")},methods:{avajauuenda(){this.isChat=!0,this.count++},selectUser(e){this.$emit("select:user",e),e.self||(this.selectedUser=e)},onMessage(e,t){this.$emit("on:message",e,t)},renderComponent(){this.isChat=!0,S.Z.on("get updated room users",(e=>{console.log("xx-notification "+e.users.length),e.users.length>1&&(this.isTwoUsersOnline=!0)}))},async handleBookings(){const e=await B.Z.getProvider(this.userIn.id);e&&(this.bookings=e.booking.filter((e=>"confirmed"!==e.status&&"waiting"!==e.status)))},createBookingDate(){this.bookingDate=22},messageSeen(e){this.isSeen=!0,this.ri=this.userIsProvider.yritys+e.user.username,console.log("Ri means: "+this.ri),this.room=this.userIsProvider.yritys+e.user.username;const t=this.userIn.username,s=this.ri,n={room:s,userID:this.userIn.id,username:t};this.$emit("chatCredentials",n),S.Z.emit("online",s),S.Z.emit("updateRoom",this.ri),S.Z.emit("room users count"),S.Z.on("get room users count",(e=>{console.log("Can we get users data from backend here??? "+e.users.length)})),this.id=e.id,this.editStatus(e.id,"seen")},async editStatus(e,t){const s={status:t},n=await U.Z.updateRecipient(e,s);console.log("Is status updated: "+n.status),this.$emit("update:status",e)},openImagePanel(e){this.isOpenImage=!0,this.srcImg=s(3866)(`./${e.map((e=>e.name))}`),""!==this.srcImg&&(this.isImageOpen=!0)},confirmBooking(e){this.editStatus(e,"confirmed"),this.bookings=this.bookings.filter((t=>t.id!==e)),this.bookings.length<1&&this.$router.push("/"),this.$emit("remove:booking",e)},closeImagePanel(){this.isOpenImage=!1,this.isImageOpen=!1},exitFromNotificationData(){location.reload()}}};const $=(0,x.Z)(O,[["render",k],["__scopeId","data-v-ae86f6d2"]]);var j=$},3866:function(e,t,s){var n={"./file-1683564858678-jane_doe.png":7138,"./file-1683983780652-alus merellÃ¤.jpg":9107};function o(e){var t=i(e);return s(t)}function i(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}o.keys=function(){return Object.keys(n)},o.resolve=i,e.exports=o,o.id=3866},7138:function(e,t,s){"use strict";e.exports=s.p+"img/file-1683564858678-jane_doe.05f8ae65.png"},9107:function(e,t,s){"use strict";e.exports=s.p+"img/file-1683983780652-alus merellÃ¤.72e40714.jpg"}},t={};function s(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,s),i.exports}s.m=e,function(){var e=[];s.O=function(t,n,o,i){if(!n){var r=1/0;for(u=0;u<e.length;u++){n=e[u][0],o=e[u][1],i=e[u][2];for(var a=!0,l=0;l<n.length;l++)(!1&i||r>=i)&&Object.keys(s.O).every((function(e){return s.O[e](n[l])}))?n.splice(l--,1):(a=!1,i<r&&(r=i));if(a){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[n,o,i]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}}(),function(){s.f={},s.e=function(e){return Promise.all(Object.keys(s.f).reduce((function(t,n){return s.f[n](e,t),t}),[]))}}(),function(){s.u=function(e){return"js/"+e+"."+{86:"c3785121",113:"ac435af3",161:"dd6cffa5",185:"154e1e7f",227:"c7d34c43",244:"2dc9c746",300:"f95f7ed9",320:"4e377145",360:"beb4ee2c",365:"bb05810d",382:"d345b66d",383:"676104e9",394:"af5cf985",434:"db5b4f62",437:"df205152",515:"6dc2f576",901:"a244de7a"}[e]+".js"}}(),function(){s.miniCssF=function(e){return"css/"+e+"."+{86:"982c571a",113:"c97a6825",300:"99444498",320:"4bfaa8cc",360:"72fbd56a",365:"a161bbc7",383:"8b88fb25",394:"b8a1b1a4",434:"be5be229",437:"e889df20",515:"982c571a"}[e]+".css"}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="prore-mongo:";s.l=function(n,o,i,r){if(e[n])e[n].push(o);else{var a,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+i){a=d;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,s.nc&&a.setAttribute("nonce",s.nc),a.setAttribute("data-webpack",t+i),a.src=n),e[n]=[o];var g=function(t,s){a.onerror=a.onload=null,clearTimeout(m);var o=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),o&&o.forEach((function(e){return e(s)})),t)return t(s)},m=setTimeout(g.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=g.bind(null,a.onerror),a.onload=g.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){s.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,s,n,o){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css";var r=function(s){if(i.onerror=i.onload=null,"load"===s.type)n();else{var r=s&&("load"===s.type?"missing":s.type),a=s&&s.target&&s.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+a+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=r,l.request=a,i.parentNode&&i.parentNode.removeChild(i),o(l)}};return i.onerror=i.onload=r,i.href=t,s?s.parentNode.insertBefore(i,s.nextSibling):document.head.appendChild(i),i},t=function(e,t){for(var s=document.getElementsByTagName("link"),n=0;n<s.length;n++){var o=s[n],i=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(i===e||i===t))return o}var r=document.getElementsByTagName("style");for(n=0;n<r.length;n++){o=r[n],i=o.getAttribute("data-href");if(i===e||i===t)return o}},n=function(n){return new Promise((function(o,i){var r=s.miniCssF(n),a=s.p+r;if(t(r,a))return o();e(n,a,null,o,i)}))},o={143:0};s.f.miniCss=function(e,t){var s={86:1,113:1,300:1,320:1,360:1,365:1,383:1,394:1,434:1,437:1,515:1};o[e]?t.push(o[e]):0!==o[e]&&s[e]&&t.push(o[e]=n(e).then((function(){o[e]=0}),(function(t){throw delete o[e],t})))}}}(),function(){var e={143:0};s.f.j=function(t,n){var o=s.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else if(365!=t){var i=new Promise((function(s,n){o=e[t]=[s,n]}));n.push(o[2]=i);var r=s.p+s.u(t),a=new Error,l=function(n){if(s.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",a.name="ChunkLoadError",a.type=i,a.request=r,o[1](a)}};s.l(r,l,"chunk-"+t,t)}else e[t]=0},s.O.j=function(t){return 0===e[t]};var t=function(t,n){var o,i,r=n[0],a=n[1],l=n[2],c=0;if(r.some((function(t){return 0!==e[t]}))){for(o in a)s.o(a,o)&&(s.m[o]=a[o]);if(l)var u=l(s)}for(t&&t(n);c<r.length;c++)i=r[c],s.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return s.O(u)},n=self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var n=s.O(void 0,[998],(function(){return s(7718)}));n=s.O(n)})();
//# sourceMappingURL=app.e2aa4998.js.map