"use strict";(self["webpackChunkprore_mongo"]=self["webpackChunkprore_mongo"]||[]).push([[287,610,856],{4044:function(e,o,i){i.d(o,{A:function(){return A}});var n=i(6768),t=i(4232);const s={key:0},r={class:"waiting-info"},l={style:{display:"flex","justify-content":"right"}},a=["src"],d={key:0},c={key:0},u={key:1},g={key:1},k={key:0},f={key:1},m={key:1},h={class:"pro-info"},p={style:{float:"right"}},v={key:0},y={key:1},B={key:2},_={key:0},b={key:1},C={key:3},T={key:0,colspan:"2"},I={key:1,colspan:"2"},D={key:4},E={key:0,colspan:"2"},M={key:1,colspan:"2"};function w(e,o,w,L,R,S){const O=(0,n.g2)("monthConverter"),X=(0,n.g2)("MDBBtn"),A=(0,n.g2)("MDBTable");return"for-recipient"===w.status?((0,n.uX)(),(0,n.CE)("div",s,[(0,n.Lk)("div",r,[(0,n.Lk)("div",l,[(0,n.Lk)("img",{style:{width:"50px"},src:i(6674),alt:"okay"},null,8,a)]),o[2]||(o[2]=(0,n.eW)(" ( ")),(0,n.Lk)("b",null,(0,t.v_)(w.content.ordered[0].yritys),1),(0,n.eW)(" ) - "+(0,t.v_)(w.content.header),1),o[3]||(o[3]=(0,n.Lk)("br",null,null,-1)),(0,n.bF)(O,{num:w.content.onTime[0].month},null,8,["num"]),(0,n.eW)(" "+(0,t.v_)(w.content.onTime[0].day)+" / "+(0,t.v_)(w.content.onTime[0].year),1),o[4]||(o[4]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)(" klo "+(0,t.v_)(w.content.onTime[0].hours)+" : "+(0,t.v_)(w.content.onTime[0].minutes),1),o[5]||(o[5]=(0,n.Lk)("br",null,null,-1)),R.isMoving?((0,n.uX)(),(0,n.CE)("div",d,["here"===R.isMoving?((0,n.uX)(),(0,n.CE)("p",c,(0,t.v_)(w.content.ordered[0].yritys)+" odottaa sinua osoitteseen: "+(0,t.v_)(w.content.ordered[0].address),1)):"go"===R.isMoving?((0,n.uX)(),(0,n.CE)("p",u,(0,t.v_)(w.content.ordered[0].yritys)+" tulossa sovittuun osoitteeseen!",1)):(0,n.Q3)("",!0)])):((0,n.uX)(),(0,n.CE)("div",g,[0===w.content.ordered[0].range?((0,n.uX)(),(0,n.CE)("p",k,(0,t.v_)(w.content.ordered[0].yritys)+" odottaa sinua osoitteseen: "+(0,t.v_)(w.content.ordered[0].address),1)):w.content.ordered[0].range>0?((0,n.uX)(),(0,n.CE)("p",f,(0,t.v_)(w.content.ordered[0].yritys)+" tulossa sovittuun osoitteeseen!",1)):(0,n.Q3)("",!0)])),(0,n.bF)(X,{block:"",outline:"warning",onClick:o[0]||(o[0]=e=>S.removeComplitedBookingPanel(w.content))},{default:(0,n.k6)((()=>o[1]||(o[1]=[(0,n.eW)(" (Kustub muidu kui aeg läbi saab) - Saab eemaldada kohe (ajutine lahendus) ")]))),_:1})])])):((0,n.uX)(),(0,n.CE)("div",m,[(0,n.Lk)("div",h,[(0,n.Lk)("div",p,[(0,n.bF)(O,{num:w.content.onTime[0].month},null,8,["num"]),(0,n.eW)(" "+(0,t.v_)(w.content.onTime[0].day)+" / "+(0,t.v_)(w.content.onTime[0].year),1),o[6]||(o[6]=(0,n.Lk)("br",null,null,-1)),(0,n.eW)(" klo "+(0,t.v_)(w.content.onTime[0].hours>=10?w.content.onTime[0].hours:"0"+w.content.onTime[0].hours)+" : "+(0,t.v_)(w.content.onTime[0].minutes>=10?w.content.onTime[0].minutes:"0"+w.content.onTime[0].minutes),1)]),"for-provider"===w.status?((0,n.uX)(),(0,n.Wv)(A,{key:0,borderless:"",style:{"font-size":"18px",color:"#ddd","text-align":"left",padding:"10px",width:"100%"}},{default:(0,n.k6)((()=>[(0,n.Lk)("tbody",null,[(0,n.Lk)("tr",null,[o[7]||(o[7]=(0,n.Lk)("td",null," Sovittu: ",-1)),(0,n.Lk)("td",null,(0,t.v_)(w.content.header),1)]),R.offer?((0,n.uX)(),(0,n.CE)("tr",v,[o[8]||(o[8]=(0,n.Lk)("td",null," Hinnalla: ",-1)),(0,n.Lk)("td",null,(0,t.v_)(R.offer.price)+" Eur. ",1)])):(0,n.Q3)("",!0),R.offer&&w.provider.range>0?((0,n.uX)(),(0,n.CE)("tr",y,[o[9]||(o[9]=(0,n.Lk)("td",null," Etäisyys: ",-1)),(0,n.Lk)("td",null,(0,t.v_)(R.offer.distance)+" km. ",1)])):(0,n.Q3)("",!0),R.offer&&w.provider.range>0?((0,n.uX)(),(0,n.CE)("tr",B,[o[10]||(o[10]=(0,n.Lk)("td",null," Matkaiaka: ",-1)),(0,n.Lk)("td",null," noin "+(0,t.v_)(R.offer.duration)+". ",1)])):(0,n.Q3)("",!0),(0,n.Lk)("tr",null,[o[11]||(o[11]=(0,n.Lk)("td",null," Paikka: ",-1)),0===w.provider.range?((0,n.uX)(),(0,n.CE)("td",_,(0,t.v_)(w.provider.address),1)):((0,n.uX)(),(0,n.CE)("td",b,(0,t.v_)(w.content.address),1))]),R.isMoving?((0,n.uX)(),(0,n.CE)("tr",C,["here"===R.isMoving?((0,n.uX)(),(0,n.CE)("td",T,o[12]||(o[12]=[(0,n.Lk)("p",{style:{color:"deepskyblue"}}," Asiakas tulossa! ",-1)]))):"go"===R.isMoving?((0,n.uX)(),(0,n.CE)("td",I,o[13]||(o[13]=[(0,n.Lk)("p",{style:{color:"deepskyblue"}}," Meno asiakkaan luonna! ",-1)]))):(0,n.Q3)("",!0)])):((0,n.uX)(),(0,n.CE)("tr",D,[0===w.provider.range?((0,n.uX)(),(0,n.CE)("td",E,o[14]||(o[14]=[(0,n.Lk)("p",{style:{color:"deepskyblue"}}," Asiakas tulossa! ",-1)]))):w.provider.range>0?((0,n.uX)(),(0,n.CE)("td",M,o[15]||(o[15]=[(0,n.Lk)("p",{style:{color:"deepskyblue"}}," Meno asiakkaan luonna! ",-1)]))):(0,n.Q3)("",!0)]))])])),_:1})):(0,n.Q3)("",!0)])]))}i(8111),i(116);var L=i(5846),R=i(6765),S={name:"Info",props:{index:Number,content:Object,status:String,provider:Object},components:{MDBBtn:L.al,MDBTable:L.EU,monthConverter:R.A},data(){return{offer:this.content.isIncludeOffers?this.content.offers.find((e=>e.provider===this.content.ordered[0])):null,isMoving:this.content.isIncludeOffers?this.content.offers[0].place:null}},methods:{removeCompletedBookingPro(e){this.$emit("remove:proConfirmed",e)},removeComplitedBookingPanel(e){this.$emit("remove:complitedBookingPanel",e)}}},O=i(1241);const X=(0,O.A)(S,[["render",w],["__scopeId","data-v-9f40f3e4"]]);var A=X},6260:function(e,o,i){i.r(o),i.d(o,{default:function(){return A}});i(4114),i(8111),i(2489);var n=i(6768),t=i(4232);const s={key:0},r={key:1},l={key:0,class:"spinner-border",role:"status"},a={key:1},d={class:"scalein animation-duration-3000 animation-iteration flex align-items-center justify-content-center font-bold w-full"},c={class:"client-header"},u={class:"client-orders"},g={id:"info-block-confirmed"},k={class:"file-marker"},f={class:"box-title-confirmed"},m={class:"box-contents-confirmed"},h={class:"booking_time"},p={key:0},v={style:{"margin-top":"23px"}};function y(e,o,i,y,B,_){const b=(0,n.g2)("recipientResult"),C=(0,n.g2)("MDBCol"),T=(0,n.g2)("MDBRow"),I=(0,n.g2)("MDBBtn"),D=(0,n.g2)("MDBBadge"),E=(0,n.g2)("MDBTextarea"),M=(0,n.g2)("MDBContainer");return(0,n.uX)(),(0,n.CE)("div",null,[(0,n.bF)(M,{style:{"margin-top":"50px"}},{default:(0,n.k6)((()=>[B.isBooking?((0,n.uX)(),(0,n.CE)("div",s,[(0,n.bF)(b,{test:i.test,booking:B.booking,images:B.images,proRefSlides:i.proRefSlides,bookingTime:B.recipientDateTime,booking_offers:B.booking.offers,providers:B.providerMatchByProfession,confirmedBookings:B.confirmedBookings,line:B.line,onUpdateBookingDate:_.handleUpdateBookingDate,"onSet:order:to:send":_.handleOrderToSend,onEditBookingOfferStatus:_.handleEditBookingOfferStatus,"onClient:confirmed_provider":e.handleClientConfirmedProvider,onRemoveOfferedBooking:_.handleRemoveOfferedBookings,"onCansel:result":_.handleCanselResult,onEditDescription:_.handleEditDescription,onAddImage:_.handleAddImage,onEditImage:_.handleEditImage,onRemoveImage:_.handleRemoveImage,onFinalinfo:e.finalinfo,chatusers:i.chatusers,selecteduser:i.selecteduser,messages:i.messages,onSelect:_.selectUser,onNoSelect:_.noSelectUser,onMessage:_.onMessage,onInitializeChat:_.handleInitializeChat,onJoinChatPanel:_.handleJoinChatPanel,onFilter_provider:_.handleFilterProvider,onOffer_confirmed:_.handleOfferedBookingConfirmed,onOtherUser:_.otherUser},null,8,["test","booking","images","proRefSlides","bookingTime","booking_offers","providers","confirmedBookings","line","onUpdateBookingDate","onSet:order:to:send","onEditBookingOfferStatus","onClient:confirmed_provider","onRemoveOfferedBooking","onCansel:result","onEditDescription","onAddImage","onEditImage","onRemoveImage","onFinalinfo","chatusers","selecteduser","messages","onSelect","onNoSelect","onMessage","onInitializeChat","onJoinChatPanel","onFilter_provider","onOffer_confirmed","onOtherUser"])])):((0,n.uX)(),(0,n.CE)("div",r,[B.isSpinner?((0,n.uX)(),(0,n.CE)("div",l,o[2]||(o[2]=[(0,n.Lk)("span",{class:"visually-hidden"},"Loading...",-1)]))):((0,n.uX)(),(0,n.CE)("div",a,[(0,n.bF)(T,null,{default:(0,n.k6)((()=>[(0,n.bF)(C,{md:"8"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",d,[(0,n.Lk)("p",{onClick:o[0]||(o[0]=o=>e.$router.push("/calendar"))},"Katso vahvistetut tilaukset kalenterista!")])])),_:1}),(0,n.bF)(C,{style:{padding:"20px 5px 20px 5px",color:"cadetblue"},md:"4"},{default:(0,n.k6)((()=>[(0,n.Lk)("h3",c,(0,t.v_)(B.t("recipient_panel_you_have")+" "+i.recipientBookings.length+" "+B.t("recipient_panel_open_orders")),1)])),_:1})])),_:1}),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(i.recipientBookings,((e,i)=>((0,n.uX)(),(0,n.Wv)(T,{key:i,class:"bookings"},{default:(0,n.k6)((()=>[(0,n.Lk)("div",u,[(0,n.Lk)("aside",g,[(0,n.Lk)("section",k,[(0,n.Lk)("div",null,[(0,n.Lk)("div",f,(0,t.v_)(e.isIncludeOffers?e.offers.length>0?e.offers.length+" "+B.t("offerCountNotification"):B.t("recipient_panel_no_offers"):B.t("recipient_panel_order_is_pending")),1),(0,n.Lk)("div",m,[(0,n.bF)(T,null,{default:(0,n.k6)((()=>[(0,n.bF)(C,null,{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e.date)+" ",1),(0,n.Lk)("p",h," klo "+(0,t.v_)(new Date(e.created).getHours()>=10?new Date(e.created).getHours():"0"+new Date(e.created).getHours())+" : "+(0,t.v_)(new Date(e.created).getMinutes()>=10?new Date(e.created).getMinutes():"0"+new Date(e.created).getMinutes()),1)])),_:2},1024),(0,n.bF)(C,null,{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e.header),1)])),_:2},1024),(0,n.bF)(C,{lg:"4"},{default:(0,n.k6)((()=>[e.isIncludeOffers?((0,n.uX)(),(0,n.Wv)(I,{key:1,outline:"success",size:"lg",onClick:o=>_.handleRecipientResult(e.id,e),style:{width:"100%"}},{default:(0,n.k6)((()=>[(0,n.Lk)("span",{class:(0,t.C4)({date_expired:e.created_ms-(new Date).getTime()<=0})},(0,t.v_)(B.t("recipient_panel_order")),3),e.offers.filter((e=>e.isNewOffer)).length>0?((0,n.uX)(),(0,n.Wv)(D,{key:0,color:"danger",class:"ms-2"},{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(e.offers.filter((e=>e.isNewOffer)).length),1)])),_:2},1024)):(0,n.Q3)("",!0)])),_:2},1032,["onClick"])):((0,n.uX)(),(0,n.CE)("div",p,[i===B.selectedIndex?((0,n.uX)(),(0,n.Wv)(I,{key:0,outline:"danger",block:"",size:"lg",onClick:_.canselQuitSelectedBooking},{default:(0,n.k6)((()=>o[3]||(o[3]=[(0,n.eW)("Poistu")]))),_:1},8,["onClick"])):((0,n.uX)(),(0,n.Wv)(I,{key:1,color:"danger",onClick:e=>_.handleQuitSelectedBooking(i)},{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(B.t("recipient_panel_quit_order")),1)])),_:2},1032,["onClick"]))]))])),_:2},1024)])),_:2},1024),B.selectedIndex!==i||e.isIncludeOffers?(0,n.Q3)("",!0):((0,n.uX)(),(0,n.Wv)(T,{key:0},{default:(0,n.k6)((()=>[(0,n.bF)(C,{lg:"8",style:{"text-align":"center"}},{default:(0,n.k6)((()=>[B.isQuitBooking?((0,n.uX)(),(0,n.Wv)(E,{key:0,white:"",style:{},modelValue:B.clientQuitBookingReason,"onUpdate:modelValue":o[1]||(o[1]=e=>B.clientQuitBookingReason=e),label:B.t("recipient_panel_give_reason"),rows:"3"},null,8,["modelValue","label"])):(0,n.Q3)("",!0)])),_:1}),(0,n.bF)(C,{lg:"4"},{default:(0,n.k6)((()=>[B.isQuitBooking&&B.clientQuitBookingReason.length>3?((0,n.uX)(),(0,n.Wv)(I,{key:0,block:"",color:"success",size:"lg>",style:{"margin-top":"10px"},onClick:o=>_.clientRejectBookingNoOffers(e)},{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(B.t("recipient_panel_confirm_quit")),1)])),_:2},1032,["onClick"])):(0,n.Q3)("",!0)])),_:2},1024)])),_:2},1024))])])])])])])),_:2},1024)))),128)),(0,n.Lk)("div",v,[(0,n.bF)(I,{outline:"info",block:"",size:"lg",onClick:_.newBooking},{default:(0,n.k6)((()=>[(0,n.eW)((0,t.v_)(B.t("recipient_panel_new_order")),1)])),_:1},8,["onClick"])])]))]))])),_:1})])}i(7588),i(1701);var B=i(5846),_=i(144),b=i(6510),C=i(8405),T=i(5384),I=i(1005),D=i(1769),E=i(407),M=i(2456),w=i(4044),L=i(6765),R=i(1690),S={name:"recipient-panel",props:{test:Boolean,chatusers:Array,selecteduser:null,messages:Array,proRefSlides:Array,recipientTest:null,recipientBookings:Array,confirmedBookingsByClient:Array,confirmedBookingsByProvider:Array},data(){const{t:e}=(0,T.s9)();return{t:e,id:"",isSpinner:!1,images:[],userId:null,bookings:this.recipientBookings,provider:{},booking:null,offers:[],isQuitBooking:!1,currentRoom:"",selectedIndex:null,isPressedQuit:!1,clientQuitBookingReason:"",d:null,confirmedBookings:[],clientConfirmedBookings:[],isBooking:!1,providerMatchByProfession:[],providerMatchingRequirements:null,line:"",recipientDateTime:null,providersAvailable:[],providersBusy:[]}},setup(){const e=(0,_.KR)(!1);return{isAvailable:e}},components:{liveChat:b["default"],bookingInfo:w.A,recipientResult:I["default"],MDBBtn:B.al,MDBContainer:B.Dj,MDBRow:B.gU,MDBCol:B.m6,MDBTextarea:B.QP,MDBBadge:B.nf},async mounted(){const e=window.localStorage.getItem("loggedAppUser");if(e){const o=JSON.parse(e);this.userId=o.id,this.provider=await D.A.getProvider(o.id),this.handleRecipientBookings()}else this.$router.push("/")},methods:{handleJoinChatPanel(e){console.log("Join chat room "+e),this.$emit("joinChatPanel",e)},handleOfferedBookingConfirmed(e,o){this.$emit("offer_confirmed",e,o)},async handleEditBookingOfferStatus(e){console.log("Editing offer status id: "+e.id),await M.A.editStatus(e.id,{isNewOffer:!1}),this.offers.map((o=>o.id===e.id?o.isNewOffer=!1:o)),this.$emit("editOfferStatus",e.id)},async clientRejectBookingNoOffers(e){if(this.selectedIndex=null,confirm("Oletko varmaa, että haluat poista tilauksen?")){const o=await E.A.getBookingById(e.id),i=o.ordered[0].yritys+o.user.username;await this.$emit("reject_bookingByClient_no_offers",o,o.ordered[0].id,i),R.A.emit("reject map booking by client",{id:o.ordered[0].user.id,room:i,booking:o,reason:this.clientQuitBookingReason}),this.clientQuitBookingReason="",this.isQuitBooking=!1}},handleUpdateBookingDate(e,o){this.recipientDateTime=new Date(o.year,o.month,o.day,o.hours,o.minutes);const i=new Date(o.year,o.month,o.day,o.hours,o.minutes),n=o.month+1+"/"+o.day+"/"+o.year;this.$emit("recipient:date_ms",e,n,i,new Date(o.year,o.month,o.day,o.hours,o.minutes).getTime()),console.log("recipient date time "+this.recipientDateTime)},handleQuitSelectedBooking(e){this.selectedIndex=e,console.log("Index "+e),console.log("Selected index "+this.selectedIndex),this.isQuitBooking=!0},canselQuitSelectedBooking(){this.isQuitBooking=!1,this.selectedIndex=null},selectUser(e){this.$emit("select:user",e)},noSelectUser(){this.$emit("noSelected")},onMessage(e,o){this.$emit("on:message",e,o)},otherUser(e){this.$emit("otherUser",e)},handleInitializeChat(e){this.$emit("initializeChat",e)},async handleRecipientBookings(){let e=await E.A.getOwnBookings(this.userId);this.confirmedBookings=e.filter((e=>"confirmed"===e.status)),this.clientConfirmedBookings=e.filter((e=>"notSeen"===e.status||"seen"===e.status)),this.recipientBookings>0&&(this.recipientBookings[0].onTime.month||(this.isSpinner=!0))},async handleRecipientResult(e,o){this.booking=o,this.offers=o.offers,this.booking.image&&(this.images=this.booking.image),console.log("Profession: "+this.booking.professional);let i=[];i=this.booking.professional,console.log("Professional length "+this.booking.professional.length),this.recipientDateTime=new Date(o.onTime[0].year,o.onTime[0].month,o.onTime[0].day,o.onTime[0].hours,o.onTime[0].minutes),console.log("Recipient datetime: "+o.onTime[0].day),console.log("xxx "+this.recipientDateTime.getTime()),this.line=i[0],this.providerMatchByProfession=await D.A.getProvidersMatchingByProfession({result:i}),this.providerMatchByProfession=this.providerMatchByProfession.filter((e=>e.user.id!==this.userId)),this.isBooking=!0},handleFilterProvider(e){"distance"===e?this.booking.offers.sort(((e,o)=>e.distance-o.distance)):"rating"===e?this.booking.offers.sort(((e,o)=>o.provider.rating.positive-e.provider.rating.positive)):"price"===e&&this.booking.offers.sort(((e,o)=>e.price-o.price))},handleFilterByFeedback(){console.log("By feedback")},handleFilterAvailability(){console.log("Heyy here"),this.providerMatchByProfession.forEach((e=>{console.log("Recipient time "+this.recipientDateTime),e.timeoffer?e.timeoffer.forEach((o=>{C.A.providerMatchingForClient(this.recipientDateTime,{y:o.yearFrom,m:o.monthFrom,d:o.dayFrom,hour:o.hoursFrom,min:o.minutesFrom},{y:o.yearTo,m:o.monthTo,d:o.dayTo,hour:o.hoursTo,min:o.minutesTo})?(console.log("Is available "+e.yritys),this.providersAvailable.push(e)):(console.log("Is not available provider yritys "+e.yritys),this.providersBusy.push(e))})):console.log("Not timeoffer setted")})),console.log("Available length "+this.providersAvailable.length),console.log("Not available length "+this.providersBusy.length)},handleOrderToSend(e,o,i){console.log("Order is sended "+o.id),this.$emit("update:booking",o.id),this.clientConfirmedBookings=this.clientConfirmedBookings.concat(this.booking)},newBooking(){this.$router.push("/rf")},openMap(){const e="Tehnika 1-5, Antsla";this.$router.push("/recipient-public",{params:e})},compareTime(){console.log("Month is: "+L.A.month(4))},removeConfirmationNotification(){},handleEditDescription(e){this.booking.description=e},async handleAddImage(e,o){console.log("Image id in upload "+e._id),console.log("Image image in upload "+e.image),console.log("Image name in upload "+e.name),this.$emit("addImageToRecipientBookings",e,o),this.images=[...this.images,e]},handleEditImage(e,o,i,n){-1!==e&&(this.images[e]={_id:o,key:i,blob:n})},async handleRemoveImage(e){this.images.splice(e,1),console.log("Image removed from array")},handleCanselResult(e){console.log("Canseled: "+e),this.isBooking=e},async handleRemoveComplitedBookingPanel(e){const o=await E.A.getBookingById(e.id),i=o.ordered[0].yritys+e.user.username;this.$emit("archiveClientSideBooking",o,i)},async handleRemoveOfferedBookings(e,o){console.log("Removing booking id "+e.id),this.isBooking=!1,this.booking=null,this.$emit("removeBookingWithOffers",e,o)}}},O=i(1241);const X=(0,O.A)(S,[["render",y],["__scopeId","data-v-56531f54"]]);var A=X},6674:function(e,o,i){e.exports=i.p+"img/ok.c97d8292.png"}}]);
//# sourceMappingURL=287.f4732e78.js.map